# 기능 상세 스펙 문서 - 02. AI 통합

> **문서 버전**: 2.2  
> **작성일**: 2025-12-25  
> **업데이트**: 2025-12-25 - 번역 태스크 및 멀티 제공자 통합 엔진 설계
> **담당 모듈**: `src/utils/ai-service.ts`, `src/utils/api.ts`

---

## 1. 개요

### 1.1 목적
사용자가 선택한 AI 제공자(Gemini, OpenAI, Claude)와 상관없이 **톤 변환** 및 **번역** 작업을 수행할 수 있는 통일된 인터페이스를 제공합니다.

---

## 2. 통합 AI 인터페이스 (v2.2)

### 2.1 핵심 함수
```typescript
/**
 * 통합 AI 호출 함수
 */
export async function generateAIResponse(
  text: string,
  task: 'tone-conversion' | 'translation',
  options: {
    provider: AIProvider;
    model: string; // 각 제공자별 선택된 모델 (v2.2 추가)
    apiKey: string;
    targetLanguage?: string;
  }
): Promise<string | AIApiResponse>
```

---

## 3. 작업별 프롬프트 전략

### 3.1 톤 변환 (Tone Conversion)
- 기존의 격식/일반/친근 3단 구조 유지
- 결과는 항상 유효한 JSON 형식으로 수신

### 3.2 번역 (Translation) ⭐
- **페르소나**: "당신은 전문 번역가입니다."
- **핵심 규칙**:
  1. 원문의 **줄바꿈(\n) 위치를 100% 보존**할 것
  2. 번역된 결과만 출력하고 부연 설명은 생략할 것
  3. 타겟 언어의 문법과 비즈니스 뉘앙스를 최우선으로 할 것

---

## 4. 제공자별 처리 로직 (1M 토큰당 가격)

### 4.1 Google Gemini
- `gemini-3-flash` 모델 사용 ($15.00)
- `gemini-1.5-flash-8b` 모델 사용 ($0.0375) - 가장 저렴
- `JSON_MODE`를 사용하여 톤 변환 시 안정성 확보

### 4.2 OpenAI
- `gpt-5.2` 모델 사용 ($20.00)
- `gpt-4o-mini` 모델 사용 ($0.15) - 경제적인 옵션
- `response_format: { type: "json_object" }` 활용

### 4.3 Anthropic (Claude)
- `claude-4.5-sonnet` 모델 사용 ($18.00)
- `claude-3-5-haiku-latest` 모델 사용 ($0.25) - 빠른 속도 및 저비용
- 시스템 프롬프트에 형식을 명시하여 JSON 응답 유도

---

## 5. 에러 처리 및 폴백

- **네트워크 오류**: 10초 타임아웃 설정
- **토큰 제한**: 입력 텍스트 5,000자 초과 시 자동 절단 및 사용자 알림
- **포맷팅 오류**: AI 응답이 비정상적일 경우 정규식을 통한 강제 파싱 시도

---

**문서 작성**: BCA 개발팀  
**최종 업데이트**: 2025-12-25
