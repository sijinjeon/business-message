# 기능 상세 스펙 문서 - 08. 유틸리티 함수

> **문서 버전**: 1.0  
> **작성일**: 2025-12-25  
> **담당 모듈**: `src/utils/`, `src/lib/`

---

## 목차

1. [개요](#1-개요)
2. [API 유틸리티](#2-api-유틸리티)
3. [Storage 유틸리티](#3-storage-유틸리티)
4. [Crypto 유틸리티](#4-crypto-유틸리티)
5. [Clipboard 유틸리티](#5-clipboard-유틸리티)
6. [기타 유틸리티](#6-기타-유틸리티)

---

## 1. 개요

### 1.1 유틸리티 모듈 구조

```
src/utils/
├── api.ts           # AI API 통합 (366 lines)
├── storage.ts       # Chrome Storage 관리 (204 lines)
├── crypto.ts        # 암호화/복호화 (81 lines)
├── clipboard.ts     # 클립보드 연동 (33 lines)
└── errorHandler.ts  # 에러 처리 (파일 존재 추정)

src/lib/
└── utils.ts         # 공통 유틸리티
```

### 1.2 설계 원칙

- ✅ **단일 책임**: 각 파일은 하나의 도메인만 담당
- ✅ **순수 함수**: 부수 효과 최소화
- ✅ **타입 안정성**: 모든 함수에 타입 정의
- ✅ **에러 처리**: try-catch + 명확한 에러 메시지
- ✅ **문서화**: JSDoc 주석

---

## 2. API 유틸리티

**파일**: `src/utils/api.ts` (366 lines)

### 2.1 주요 함수

#### convertText (통합 변환 함수)

```typescript
export async function convertText(
  userText: string,
  provider: AIProvider,
  apiKey: string
): Promise<AIApiResponse>
```

**기능**: 선택된 AI 제공업체를 사용하여 텍스트를 3가지 톤으로 변환

**프로세스**:
1. 입력 검증
2. 제공업체별 API 호출
3. 응답 파싱
4. 타입 변환

#### validateApiKey (API 키 검증)

```typescript
export async function validateApiKey(
  provider: AIProvider,
  apiKey: string
): Promise<boolean>
```

**기능**: API 키 유효성 테스트

**방법**: 실제 API 호출로 검증

### 2.2 내부 함수

#### createSystemPrompt

```typescript
function createSystemPrompt(userText: string): string
```

**기능**: AI 프롬프트 생성 (1000+ 단어)

#### extractJsonFromResponse

```typescript
function extractJsonFromResponse(text: string): AIApiResponse
```

**기능**: AI 응답에서 JSON 추출 및 파싱

#### callGeminiAPI / callOpenAIAPI / callClaudeAPI

```typescript
async function callGeminiAPI(userText: string, apiKey: string): Promise<AIApiResponse>
async function callOpenAIAPI(userText: string, apiKey: string): Promise<AIApiResponse>
async function callClaudeAPI(userText: string, apiKey: string): Promise<AIApiResponse>
```

**기능**: 각 제공업체 API 호출

---

## 3. Storage 유틸리티

**파일**: `src/utils/storage.ts` (204 lines)

### 3.1 기본 함수

#### getStorageData

```typescript
export async function getStorageData(): Promise<AppStorage>
```

**기능**: Chrome Storage에서 전체 데이터 조회

**특징**:
- 기본값과 병합
- v0.x 마이그레이션 자동 처리

#### setStorageData

```typescript
export async function setStorageData(data: Partial<AppStorage>): Promise<void>
```

**기능**: Chrome Storage에 데이터 저장

**특징**: 부분 업데이트 지원

### 3.2 API 키 관리

```typescript
export async function saveApiKey(provider: AIProvider, apiKey: string): Promise<void>
export async function getApiKey(provider: AIProvider): Promise<string>
export async function getCurrentApiKey(): Promise<string>
```

### 3.3 설정 관리

```typescript
export async function getSelectedProvider(): Promise<AIProvider>
export async function setSelectedProvider(provider: AIProvider): Promise<void>
export async function getAutoCopyEnabled(): Promise<boolean>
export async function setAutoCopyEnabled(enabled: boolean): Promise<void>
export async function getAutoCopyTone(): Promise<'formal' | 'general' | 'friendly'>
export async function setAutoCopyTone(tone: 'formal' | 'general' | 'friendly'): Promise<void>
```

### 3.4 사용량 관리

```typescript
export async function updateDailyUsage(): Promise<number>
export async function getRemainingUsage(): Promise<number>
```

---

## 4. Crypto 유틸리티

**파일**: `src/utils/crypto.ts` (81 lines)

### 4.1 함수 목록

```typescript
async function generateKey(): Promise<CryptoKey>
export async function encryptData(plaintext: string): Promise<string>
export async function decryptData(encryptedData: string): Promise<string>
```

**상세 스펙**: [01_인증_및_API키_관리.md](./01_인증_및_API키_관리.md) 참조

---

## 5. Clipboard 유틸리티

**파일**: `src/utils/clipboard.ts` (33 lines)

### 5.1 함수 목록

```typescript
export async function readClipboard(): Promise<string>
export async function writeClipboard(text: string): Promise<void>
```

**상세 스펙**: [03_클립보드_연동.md](./03_클립보드_연동.md) 참조

---

## 6. 기타 유틸리티

### 6.1 lib/utils.ts

**파일**: `src/lib/utils.ts`

**cn 함수** (className 병합):
```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

**사용 예시**:
```tsx
<div className={cn(
  "base-class",
  isActive && "active-class",
  className
)}>
```

### 6.2 errorHandler.ts (추정)

**예상 함수**:
```typescript
export class AppError extends Error {
  constructor(
    message: string,
    public code: string,
    public userMessage?: string
  ) {
    super(message)
    this.name = 'AppError'
  }
}

export function handleApiError(error: unknown): AppError
```

---

**문서 작성**: AI 코드 분석 시스템  
**최종 업데이트**: 2025-12-25

