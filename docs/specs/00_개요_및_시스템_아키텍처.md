# 기능 상세 스펙 문서 - 00. 개요 및 시스템 아키텍처

> **문서 버전**: 1.0  
> **작성일**: 2025-12-25  
> **프로젝트**: 정중한 문장 도우미 (Business Message Helper)

---

## 목차

1. [시스템 개요](#1-시스템-개요)
2. [전체 아키텍처](#2-전체-아키텍처)
3. [기술 스택](#3-기술-스택)
4. [디렉토리 구조](#4-디렉토리-구조)
5. [데이터 흐름](#5-데이터-흐름)
6. [보안 아키텍처](#6-보안-아키텍처)
7. [성능 요구사항](#7-성능-요구사항)
8. [배포 환경](#8-배포-환경)

---

## 1. 시스템 개요

### 1.1 프로젝트 정보

**프로젝트명**: 정중한 문장 도우미 (Business Message Helper)  
**버전**: 1.0.0  
**플랫폼**: Chrome Extension (Manifest V3)  
**개발 상태**: MVP 완료, 프로덕션 배포 준비 완료

### 1.2 목적 및 목표

**핵심 목적**:
- 한국 직장 문화에 맞는 적절한 톤앤매너의 문장 작성 지원
- AI를 활용한 실시간 문장 변환 서비스 제공
- 클립보드 기반의 원클릭 워크플로우 구현

**비즈니스 목표**:
- 사용자의 문장 작성 시간 90% 단축
- MVP 출시 3개월 내 일일 활성 사용자(DAU) 1,000명 달성
- 팝업 로딩 300ms 이내, API 응답 2초 이하 유지

### 1.3 핵심 기능

1. **클립보드 자동 인식**: 복사된 텍스트 자동 감지 및 변환
2. **3가지 톤 변환**: 비즈니스 이메일, 사내 메신저, 캐주얼 채팅
3. **다중 AI 지원**: Google Gemini, OpenAI ChatGPT, Anthropic Claude
4. **보안 저장**: AES-GCM 암호화를 통한 API 키 안전 보관
5. **자동 복사**: 변환 결과 자동 클립보드 복사 (선택 가능)

### 1.4 타겟 사용자

**주요 타겟**: 2-10년차 사무직 직장인
- 이메일, 메신저로 빈번한 커뮤니케이션
- 적절한 존댓말과 표현에 대한 고민이 많음

**확장 타겟**: 고객 서비스(CS) 및 영업 담당자
- 고객과의 대화에서 일관된 전문적 톤 유지 필요

---

## 2. 전체 아키텍처

### 2.1 시스템 아키텍처 다이어그램

```
┌────────────────────────────────────────────────────────────┐
│                  User's Chrome Browser                     │
│                                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Chrome Extension (React SPA)                 │  │
│  │                                                      │  │
│  │  ┌─────────────┐         ┌──────────────┐          │  │
│  │  │  Popup UI   │         │ Options UI   │          │  │
│  │  │  (400x600)  │         │ (Settings)   │          │  │
│  │  └──────┬──────┘         └──────┬───────┘          │  │
│  │         │                       │                   │  │
│  │         └───────────┬───────────┘                   │  │
│  │                     ↓                               │  │
│  │         ┌────────────────────────┐                  │  │
│  │         │   Core Services        │                  │  │
│  │         ├────────────────────────┤                  │  │
│  │         │ - AI Integration       │                  │  │
│  │         │ - Storage Management   │                  │  │
│  │         │ - Crypto Service       │                  │  │
│  │         │ - Clipboard Service    │                  │  │
│  │         └──────────┬─────────────┘                  │  │
│  │                    │                                │  │
│  └────────────────────┼────────────────────────────────┘  │
│                       │                                   │
│         ┌─────────────┴──────────────┐                    │
│         ↓                            ↓                    │
│  ┌──────────────┐          ┌─────────────────┐           │
│  │ Chrome APIs  │          │ Chrome Storage  │           │
│  │ - Clipboard  │          │ (Local)         │           │
│  │ - Runtime    │          │ - Encrypted     │           │
│  └──────────────┘          └─────────────────┘           │
└────────────────────────────────────────────────────────────┘
                       │
                       │ HTTPS
                       ↓
        ┌──────────────────────────────┐
        │     AI API Services          │
        ├──────────────────────────────┤
        │ - Google Gemini API          │
        │ - OpenAI ChatGPT API         │
        │ - Anthropic Claude API       │
        └──────────────────────────────┘
```

### 2.2 컴포넌트 계층 구조

```
App Layer (UI Components)
├── Popup
│   ├── App.tsx (Main Container)
│   ├── TextInput (Input Component)
│   ├── ActionBar (Action Buttons)
│   └── ResultCard (Result Display)
└── Options
    └── Settings.tsx (Settings Page)

Service Layer (Business Logic)
├── API Integration (api.ts)
│   ├── Gemini Service
│   ├── ChatGPT Service
│   └── Claude Service
├── Storage Service (storage.ts)
│   ├── Read/Write Operations
│   ├── API Key Management
│   └── Settings Management
├── Crypto Service (crypto.ts)
│   ├── Encryption (AES-GCM)
│   └── Decryption
└── Clipboard Service (clipboard.ts)
    ├── Read Clipboard
    └── Write Clipboard

Data Layer
└── Chrome Storage Local
    ├── API Keys (Encrypted)
    ├── User Settings
    └── Usage Statistics
```

### 2.3 모듈 의존성

```
App.tsx
  ├── → storage.ts (API 키 조회)
  ├── → api.ts (텍스트 변환)
  ├── → clipboard.ts (클립보드 연동)
  └── → UI Components
        ├── TextInput
        ├── ActionBar
        └── ResultCard

Settings.tsx
  ├── → storage.ts (설정 저장/로드)
  ├── → api.ts (API 키 검증)
  └── → UI Components (shadcn/ui)

storage.ts
  └── → crypto.ts (암호화/복호화)

api.ts
  └── (독립적, 외부 API만 호출)

crypto.ts
  └── (독립적, Web Crypto API 사용)

clipboard.ts
  └── (독립적, Navigator API 사용)
```

---

## 3. 기술 스택

### 3.1 프론트엔드

| 기술 | 버전 | 용도 |
|------|------|------|
| **React** | 18.3.1 | UI 라이브러리 |
| **TypeScript** | 5.7.2 | 타입 안정성 |
| **Vite** | 7.0.0 | 빌드 도구 |
| **Tailwind CSS** | 3.4.17 | 스타일링 |
| **shadcn/ui** | Latest | UI 컴포넌트 라이브러리 |
| **lucide-react** | 0.542.0 | 아이콘 |
| **@radix-ui/react-*** | Latest | Headless UI 컴포넌트 |

### 3.2 Chrome Extension

| 기술 | 버전 | 용도 |
|------|------|------|
| **@crxjs/vite-plugin** | 2.0.0-beta.25 | Vite + CRX 통합 |
| **@types/chrome** | 0.0.270 | Chrome API 타입 |
| **Manifest Version** | 3 | Chrome Extension 표준 |

### 3.3 개발 도구

| 도구 | 버전 | 용도 |
|------|------|------|
| **ESLint** | 9.15.0 | 코드 품질 검사 |
| **TypeScript ESLint** | 8.15.0 | TS 린팅 |
| **Terser** | 5.36.0 | 코드 압축 |
| **Autoprefixer** | 10.4.21 | CSS 벤더 프리픽스 |
| **PostCSS** | 8.5.6 | CSS 처리 |

### 3.4 외부 API

| 서비스 | 모델 | 용도 |
|--------|------|------|
| **Google Gemini** | gemini-2.0-flash-exp | AI 텍스트 변환 |
| **OpenAI** | gpt-4o-mini | AI 텍스트 변환 |
| **Anthropic** | claude-3-5-haiku-20241022 | AI 텍스트 변환 |

---

## 4. 디렉토리 구조

### 4.1 전체 디렉토리 트리

```
business-message/
├── src/                                # 소스 코드
│   ├── popup/                          # 팝업 UI
│   │   ├── components/                 # 팝업 컴포넌트
│   │   │   ├── ActionBar.tsx          # 액션 바
│   │   │   ├── ResultCard.tsx         # 결과 카드
│   │   │   └── TextInput.tsx          # 텍스트 입력
│   │   ├── App.tsx                    # 메인 앱
│   │   ├── index.tsx                  # 엔트리 포인트
│   │   └── index.html                 # HTML 템플릿
│   ├── options/                        # 설정 페이지
│   │   ├── Settings.tsx               # 설정 UI
│   │   ├── index.tsx                  # 엔트리 포인트
│   │   └── index.html                 # HTML 템플릿
│   ├── components/                     # 공유 컴포넌트
│   │   └── ui/                        # shadcn/ui 컴포넌트
│   │       ├── alert.tsx
│   │       ├── button.tsx
│   │       ├── card.tsx
│   │       ├── checkbox.tsx
│   │       ├── input.tsx
│   │       ├── select.tsx
│   │       ├── skeleton.tsx
│   │       └── textarea.tsx
│   ├── utils/                          # 유틸리티
│   │   ├── api.ts                     # AI API 통합
│   │   ├── storage.ts                 # Chrome Storage
│   │   ├── crypto.ts                  # 암호화/복호화
│   │   ├── clipboard.ts               # 클립보드
│   │   └── errorHandler.ts            # 에러 처리
│   ├── types/                          # TypeScript 타입
│   │   └── index.ts                   # 타입 정의
│   ├── lib/                            # 라이브러리
│   │   └── utils.ts                   # 유틸리티 함수
│   └── styles/                         # 스타일
│       └── global.css                 # 전역 CSS
├── public/                             # 정적 파일
│   └── images/                        # 아이콘
│       ├── icon16.png
│       ├── icon32.png
│       └── icon128.png
├── docs/                               # 문서
│   ├── PRD.md                         # 제품 요구 명세서
│   ├── TRD.md                         # 기술 요구 명세서
│   ├── IA.md                          # 정보 구조
│   ├── CODE_GUIDELINE.md              # 코드 가이드라인
│   ├── DESIGN_GUIDE.md                # 디자인 가이드
│   ├── DEVELOPMENT_GUIDE.md           # 개발 가이드
│   └── specs/                         # 상세 스펙 (본 문서)
├── business-message-extension/         # 빌드 결과물
├── chrome-webstore/                    # 스토어 자료
├── manifest.json                       # Extension 설정
├── vite.config.ts                     # Vite 설정
├── tsconfig.json                      # TypeScript 설정
├── tailwind.config.js                 # Tailwind 설정
├── postcss.config.js                  # PostCSS 설정
├── components.json                    # shadcn/ui 설정
├── package.json                       # 프로젝트 설정
└── README.md                          # 프로젝트 소개
```

### 4.2 주요 파일 설명

#### 설정 파일

| 파일 | 용도 | 중요도 |
|------|------|--------|
| `manifest.json` | Chrome Extension 설정 | ⭐⭐⭐⭐⭐ |
| `vite.config.ts` | Vite 빌드 설정 | ⭐⭐⭐⭐⭐ |
| `tsconfig.json` | TypeScript 컴파일 설정 | ⭐⭐⭐⭐⭐ |
| `tailwind.config.js` | Tailwind CSS 설정 | ⭐⭐⭐⭐ |
| `components.json` | shadcn/ui 설정 | ⭐⭐⭐ |

#### 핵심 소스 파일

| 파일 | 라인 수 | 복잡도 | 중요도 |
|------|---------|--------|--------|
| `src/popup/App.tsx` | 270 | 중 | ⭐⭐⭐⭐⭐ |
| `src/options/Settings.tsx` | 385 | 중 | ⭐⭐⭐⭐⭐ |
| `src/utils/api.ts` | 366 | 높음 | ⭐⭐⭐⭐⭐ |
| `src/utils/storage.ts` | 204 | 중 | ⭐⭐⭐⭐⭐ |
| `src/utils/crypto.ts` | 81 | 높음 | ⭐⭐⭐⭐⭐ |
| `src/types/index.ts` | 107 | 낮음 | ⭐⭐⭐⭐ |

---

## 5. 데이터 흐름

### 5.1 사용자 플로우 (기본)

```
1. 사용자가 텍스트 복사 (Ctrl+C)
   ↓
2. Chrome 툴바 아이콘 클릭
   ↓
3. 팝업 열림 (Popup Window)
   ↓
4. 클립보드에서 텍스트 자동 읽기
   navigator.clipboard.readText()
   ↓
5. 텍스트 입력창에 자동 표시
   ↓
6. Chrome Storage에서 선택된 AI 제공업체 확인
   chrome.storage.local.get('settings.selectedProvider')
   ↓
7. Chrome Storage에서 API 키 조회
   chrome.storage.local.get('apiKeys.[provider]')
   ↓
8. API 키 복호화
   crypto.subtle.decrypt() (AES-GCM)
   ↓
9. AI API 호출
   fetch(API_ENDPOINT, { apiKey, prompt })
   ↓
10. JSON 응답 파싱
    { formal: "...", general: "...", friendly: "..." }
   ↓
11. 3가지 톤 결과 카드 표시
   ↓
12. 자동 복사 설정 확인
   chrome.storage.local.get('settings.autoCopyEnabled')
   ↓
13. (설정 시) 선택된 톤 자동 클립보드 복사
   navigator.clipboard.writeText(result[tone])
   ↓
14. 성공 메시지 표시
```

### 5.2 데이터 변환 플로우

```
원본 텍스트 (User Input)
   ↓
System Prompt 생성
├── 공통 다듬기 원칙
├── Formal 가이드라인
├── General 가이드라인
└── Friendly 가이드라인
   ↓
API Request Payload 생성
├── Gemini: { contents, generationConfig, safetySettings }
├── ChatGPT: { model, messages, temperature, max_tokens }
└── Claude: { model, messages, max_tokens, temperature }
   ↓
HTTPS Request
   ↓
AI Service Processing
   ↓
JSON Response
{
  "formal": "정중하고 전문적인 어조...",
  "general": "정중하고 부드러운 톤...",
  "friendly": "간결하고 친근한 톤..."
}
   ↓
Response Parsing
├── JSON 블록 추출 (```json...```)
├── 파싱 및 검증
└── 타입 변환 (AIApiResponse)
   ↓
UI Update
├── formal → ResultCard (기본 선택)
├── general → ResultCard
└── friendly → ResultCard
```

### 5.3 에러 처리 플로우

```
API 호출 실패
   ↓
Error Type 판별
├── 401/403 → "API 키가 유효하지 않습니다"
├── 429 → "사용량 한도에 도달했습니다"
├── 5xx → "서버 문제가 발생했습니다"
└── Network → "네트워크 연결을 확인해주세요"
   ↓
Error Message 표시
(Alert Component - destructive variant)
   ↓
로딩 상태 해제
loadingState = 'error'
   ↓
사용자 재시도 대기
("다시 생성" 버튼 활성화)
```

---

## 6. 보안 아키텍처

### 6.1 보안 계층

```
Application Layer
├── Input Validation
│   ├── 텍스트 길이 제한
│   ├── XSS 방지 (React 기본)
│   └── 타입 검증 (TypeScript)
│
├── Authentication Layer
│   ├── API 키 검증
│   └── Provider별 인증
│
└── Authorization Layer
    └── Chrome Extension 권한 최소화

Storage Layer
├── Encryption at Rest
│   ├── AES-GCM 256-bit
│   ├── PBKDF2 Key Derivation
│   └── Extension ID 기반 Salt
│
└── Chrome Storage Local
    └── Browser-only Access

Network Layer
├── HTTPS Only
│   ├── Gemini API (TLS 1.3)
│   ├── OpenAI API (TLS 1.3)
│   └── Claude API (TLS 1.3)
│
└── Content Security Policy
    ├── script-src 'self'
    └── object-src 'self'
```

### 6.2 암호화 스펙

**알고리즘**: AES-GCM (Galois/Counter Mode)
- **키 크기**: 256-bit
- **IV 크기**: 12 bytes (96-bit)
- **인증 태그**: 128-bit (기본)

**키 유도 함수**: PBKDF2
- **반복 횟수**: 100,000 iterations
- **해시**: SHA-256
- **Salt**: 'business-message-salt' + Extension ID
- **출력**: 256-bit key

**저장 형식**:
```
Base64(IV[12 bytes] + EncryptedData[variable] + AuthTag[16 bytes])
```

### 6.3 권한 모델

**Chrome Extension 권한**:
```json
{
  "permissions": [
    "storage",        // 로컬 데이터 저장
    "clipboardRead",  // 클립보드 읽기
    "clipboardWrite"  // 클립보드 쓰기
  ],
  "host_permissions": [
    "https://generativelanguage.googleapis.com/*",
    "https://api.openai.com/*",
    "https://api.anthropic.com/*"
  ]
}
```

**데이터 접근 정책**:
- ✅ Chrome Storage: 앱 전체 접근
- ✅ Clipboard: 사용자 액션 시에만
- ❌ 파일 시스템: 접근 불가
- ❌ 네트워크: AI API만 허용

---

## 7. 성능 요구사항

### 7.1 응답 시간 목표

| 메트릭 | 목표 | 현재 상태 |
|--------|------|-----------|
| 팝업 로딩 시간 | < 300ms | ✅ 달성 |
| 클립보드 읽기 | < 50ms | ✅ 달성 |
| API 응답 시간 | < 2초 | ✅ 달성 (평균) |
| 클립보드 쓰기 | < 50ms | ✅ 달성 |
| 암호화/복호화 | < 100ms | ✅ 달성 |

### 7.2 리소스 제한

| 리소스 | 제한 | 현재 상태 |
|--------|------|-----------|
| 번들 크기 | < 500KB | ✅ 약 68KB |
| 메모리 사용 | < 50MB | ✅ 약 30MB |
| CPU 사용 | < 10% | ✅ 약 5% |
| Storage 사용 | < 5MB | ✅ < 1MB |

### 7.3 최적화 기법

1. **React 최적화**
   - `React.memo()`: 컴포넌트 메모이제이션
   - `useCallback()`: 함수 메모이제이션
   - `useMemo()`: 값 메모이제이션

2. **빌드 최적화**
   - Tree-shaking: 미사용 코드 제거
   - Code splitting: 필요 시 동적 import
   - Terser: 코드 압축 (drop_console)
   - CSS purge: 미사용 스타일 제거

3. **네트워크 최적화**
   - HTTPS/2 사용
   - 요청 병렬화 방지 (순차 처리)
   - Timeout 설정 (10초)

---

## 8. 배포 환경

### 8.1 개발 환경

```bash
# Node.js 버전
node: v20.x 이상
npm: v10.x 이상

# 개발 서버 실행
npm run dev

# 브라우저 접속
chrome://extensions/
→ 개발자 모드 활성화
→ dist 폴더 로드
```

**HMR (Hot Module Replacement)**: ✅ 지원
**Source Maps**: ✅ 개발 모드 활성화

### 8.2 프로덕션 환경

```bash
# 프로덕션 빌드
npm run build

# 출력 디렉토리
dist/
├── assets/
│   ├── *.js (압축됨)
│   └── *.css (압축됨)
├── images/
│   └── icon*.png
├── src/
│   ├── popup/index.html
│   └── options/index.html
└── manifest.json

# ZIP 생성 (Chrome 웹스토어용)
cd dist && zip -r ../extension.zip .
```

**최적화**:
- ✅ 코드 압축 (Terser)
- ✅ CSS 최소화 (cssnano)
- ✅ 소스맵 제거
- ✅ console.log 제거

### 8.3 Chrome 웹스토어 배포

**필요 자료**:
1. ✅ extension.zip (빌드 결과물)
2. ✅ 스크린샷 (1280x800px)
3. ✅ 아이콘 (128x128px)
4. ✅ 상세 설명
5. ⚠️ 개인정보처리방침 URL (필요)

**배포 절차**:
1. Chrome Web Store Developer Console 접속
2. 새 항목 등록 ($5 일회성 등록비)
3. ZIP 파일 업로드
4. 스토어 정보 입력
5. 심사 제출 (평균 1-3일 소요)

---

## 9. 모니터링 및 로깅

### 9.1 에러 추적

**현재 상태**: Console.error만 사용

**권장 개선**:
```typescript
// Sentry 통합 권장
import * as Sentry from "@sentry/browser";

Sentry.init({
  dsn: "YOUR_DSN",
  environment: process.env.NODE_ENV,
  beforeSend(event) {
    // 민감 정보 필터링
    return event;
  }
});
```

### 9.2 성능 모니터링

**권장 메트릭**:
- 팝업 로딩 시간
- API 응답 시간
- 암호화/복호화 시간
- 메모리 사용량

---

## 10. 관련 문서

### 10.1 기능별 상세 스펙

1. **01_인증_및_API키_관리.md**: API 키 관리, 암호화 시스템
2. **02_AI_통합.md**: AI API 연동 (Gemini, ChatGPT, Claude)
3. **03_클립보드_연동.md**: 클립보드 읽기/쓰기
4. **04_팝업_UI.md**: 팝업 인터페이스 상세
5. **05_설정_UI.md**: 설정 페이지 상세
6. **06_데이터베이스_스토리지.md**: Chrome Storage, 데이터 스키마
7. **07_UI_컴포넌트.md**: shadcn/ui 컴포넌트 상세
8. **08_유틸리티_함수.md**: 유틸리티 함수 명세
9. **09_타입_시스템.md**: TypeScript 타입 정의

### 10.2 프로젝트 문서

- **PRD.md**: 제품 요구 명세서
- **TRD.md**: 기술 요구 명세서
- **IA.md**: 정보 구조 설계
- **CODE_GUIDELINE.md**: 코드 작성 가이드
- **DESIGN_GUIDE.md**: 디자인 시스템
- **DEVELOPMENT_GUIDE.md**: 개발 가이드

---

**문서 작성**: AI 코드 분석 시스템  
**최종 업데이트**: 2025-12-25

