# 기능 상세 스펙 문서 - 01. 인증 및 API 키 관리

> **문서 버전**: 2.3 (2026 Update)
> **작성일**: 2026-01-01
> **업데이트**: 2026-01-01 - 암호화 유틸리티 보안 강화 및 전역 설정 통합
> **담당 모듈**: `src/utils/crypto.ts`, `src/utils/storage.ts`

---

## 1. 개요 (v2.3)

사용자의 민감한 AI API 키를 안전하게 보호하기 위해 업계 표준인 AES-GCM 암호화 기술을 적용하고 있습니다. 모든 키는 사용자의 로컬 환경을 벗어나지 않으며, 암호화된 상태로만 영구 저장됩니다.

---

## 2. 보안 아키텍처

### 2.1 암호화 스펙
- **알고리즘**: AES-GCM (256-bit)
- **키 유도 (KDF)**: PBKDF2 (SHA-256, 100,000 iterations)
- **Salt**: 확장 프로그램 ID(`chrome.runtime.id`)와 고정 Salt를 결합하여 사용자마다 고유한 키를 생성합니다.

### 2.2 키 관리 프로세스
1. **저장**: 입력된 API 키는 즉시 암호화되어 `apiKeys` 객체에 저장됩니다.
2. **조회**: AI 호출 직전에만 복호화되어 메모리에 일시적으로 적재되며, 작업 완료 후 가비지 컬렉션에 의해 제거됩니다.
3. **격리**: 각 AI 제공자(Gemini, OpenAI, Claude)별 키는 독립적으로 관리됩니다.

---

## 3. 검증 및 연결 테스트

- **실시간 검증**: 설정 페이지에서 "연결 테스트" 버튼을 통해 실제 AI API 호출(번역 작업)을 수행하여 키의 유효성을 즉각 확인합니다.
- **오류 피드백**: 복호화 실패 시 빈 문자열을 반환하여 시스템의 비정상 종료를 방지하고, 사용자에게 키 재설정을 안내합니다.

---

## 4. 마이그레이션 및 하위 호환성

- **v1.x 마이그레이션**: 이전 버전의 평문 저장 방식 또는 단일 제공자 구조에서 v2.3의 암호화된 멀티 제공자 구조로의 자동 데이터 변환 로직이 `src/utils/storage.ts`에 포함되어 있습니다.

---

**문서 업데이트**: 2026-01-01
