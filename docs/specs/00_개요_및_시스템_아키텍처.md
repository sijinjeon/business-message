# 기능 상세 스펙 문서 - 00. 개요 및 시스템 아키텍처

> **문서 버전**: 2.5.1 (2026.01.12 Update)
> **작성일**: 2026-01-01
> **업데이트**: 2026-01-12 - 단축키 기능 개선 및 input/textarea 선택 텍스트 처리 고도화
> **프로젝트**: 비즈니스 커뮤니케이션 어시스턴트 (BCA)

---

## 1. 시스템 개요 (v2.5.1 변경사항)

### 1.1 프로젝트 정보
**버전**: 2.5.1
**개발 상태**: v2.5.1 완료 (단축키 기능 개선 및 안정화)

### 1.2 확장된 목표
- **Gemini 3.0 도입**: 차세대 AI 모델 지원을 통한 추론 속도 및 정확도 극대화
- **인스턴트 액션**: 전역 단축키를 통한 즉시 번역 및 톤 변환(선택 영역 대체) 기능 강화
- **UI/UX 안정화**: 팝업 내 결과 리스트 스크롤 오류 수정 및 레이아웃 최적화
- **하이브리드 스토리지 아키텍처**: 안정적인 상태 관리와 마이그레이션 로직 고도화
- **백그라운드 하트비트**: MV3 환경에서의 서비스 워커 안정성 확보를 위한 주기적 활성화 메커니즘 도입
- **input/textarea 처리 개선**: `selectionStart/End`를 사용한 직접 텍스트 추출로 호환성 향상
- **디버깅 로그 강화**: Service Worker 및 Content Script에 상세 로그 추가

---

## 2. 전체 아키텍처 (v2.3 최신화)

### 2.1 시스템 구조도 변경
- **Service Layer 중심 설계**: UI와 비즈니스 로직의 완전한 분리
- **StorageService**: `chrome.storage.local`을 래핑하여 타입 안정성 및 자동 마이그레이션 지원

```
Service Layer (Business Logic)
├── AI Service (src/services/ai/)
│   ├── AIOrchestrator (통합 제어)
│   ├── BaseAIProvider (추상 인터페이스)
│   └── Providers (Gemini, OpenAI, Claude 전용 어댑터)
├── Storage Service (src/services/storage-service.ts)
│   ├── CRUD 인터페이스
│   └── Schema Migration (2026 모델 자동 전환)
└── Utility Layer
    ├── Translation (src/utils/translation.ts)
    └── Crypto (src/utils/crypto.ts)
```

---

## 3. 최신 기술 스택 (2026)

| 기술 | 버전 | 역할 |
|------|------|------|
| **Vite** | 7.0.0 | 초고속 빌드 및 HMR |
| **TypeScript** | 5.7.2 | Strict 모드 기반 타입 안정성 |
| **AI Models** | 2026 Latest | Gemini 3.0-flash, GPT-5.2, Claude 4.5 |
| **Chrome API** | Manifest V3 | 서비스 워커 및 알람 기반 백그라운드 프로세스 |

---

## 5. 데이터 흐름 (v2.3 고도화)

### 5.1 사용량 로그 기록 흐름
1. AI 응답 수신 시 `AIOrchestrator`에서 결과 반환
2. `utils/storage.ts`의 `logUsage` 함수 호출
3. 사용된 토큰 수(입력/출력) 및 모델별 단가(pricePer1M)를 기준으로 비용 계산
4. `usageLogs` 배열에 타임스탬프와 함께 저장 (최근 1000개 유지)
5. `dailyUsage` 카운트 업데이트

---

## 6. v2.5.1 주요 변경사항 (2026.01.12)

### 6.1 단축키 기능 개선
- **input/textarea 선택 텍스트 처리**: `window.getSelection()` 대신 `selectionStart/End`로 직접 추출
- **React 프레임워크 호환**: 텍스트 교체 후 `input`, `change` 이벤트 발생

### 6.2 Service Worker 안정성
- **단축키 상태 로깅**: 시작 시 등록된 단축키 목록 자동 로깅
- **하트비트 상태 확인**: 알람 설정 성공 여부 확인 강화

### 6.3 에러 핸들링 개선
- **isRestrictedPage()**: 제한된 페이지 감지 (chrome://, edge://, about: 등)
- **showNotification()**: Content Script 없이도 시스템 알림 표시
- **Content Script 동적 주입**: manifest.json에서 파일 경로 자동 로드

### 6.4 디버깅 강화
- Background Service Worker에 상세 로그 추가 (`[BCA]` prefix)
- Content Script에 상세 로그 추가 (`[BCA Content]`, `[BCA Replacer]` prefix)

---

**문서 업데이트**: 2026-01-12
