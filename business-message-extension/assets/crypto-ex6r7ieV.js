var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);class n{buildPrompt(e,t,n){return"translation"===t?`\n# Role\nProfessional translator.\n\n# Task\nTranslate the following text to ${n||"Korean"}.\n\n# Critical Rules\n1. PRESERVE ALL LINE BREAKS (\\n) EXACTLY.\n2. Natural and professional tone.\n3. Output ONLY the translation result.\n\n# Original Text\n${e}\n\n# Translation\n`:`\n# Role\n한국 직장 문화와 커뮤니케이션에 능숙한 AI 어시스턴트.\n\n# Instruction\n주어진 'Original Text'를 아래 JSON 형식에 맞춰 세 가지 톤(격식/일반/친근)으로 변환하세요.\n\n# Output Format\n반드시 아래 JSON 형식으로만 응답하세요. 설명은 생략합니다.\n{\n  "formal": "정중하고 전문적인 어조",\n  "general": "정중하고 부드러운 톤",\n  "friendly": "간결하고 친근한 톤"\n}\n\n# Original Text\n${e}\n`}parseJsonResponse(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/)||e.match(/\{[\s\S]*\}/);if(!t)throw new Error("유효한 JSON 응답을 찾을 수 없습니다.");try{const e=JSON.parse(t[1]||t[0]);if(!e.formal||!e.general||!e.friendly)throw new Error("필수 필드가 누락되었습니다.");return e}catch(n){throw new Error("AI 응답 파싱 실패")}}}class r{static async execute(e,t,n){const r=this.providers[n.provider];if(!r)throw new Error(`지원하지 않는 제공자입니다: ${n.provider}`);const o=await r.call(e,t,n);return"tone-conversion"===t?this.parseJson(o):o.trim()}static parseJson(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/)||e.match(/\{[\s\S]*\}/);if(!t)throw new Error("유효한 JSON 응답을 찾을 수 없습니다.");try{return JSON.parse(t[1]||t[0])}catch(n){throw new Error("AI 응답 파싱 실패")}}}async function o(){const e=chrome.runtime.id,t=new TextEncoder,n="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,r=await n.subtle.importKey("raw",t.encode(e+"business-message-helper"),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return n.subtle.deriveKey({name:"PBKDF2",salt:t.encode("business-message-salt"),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function a(e){try{const t=await o(),n=(new TextEncoder).encode(e),r="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,a=r.getRandomValues(new Uint8Array(12)),s=await r.subtle.encrypt({name:"AES-GCM",iv:a},t,n),i=new Uint8Array(a.length+s.byteLength);i.set(a),i.set(new Uint8Array(s),a.length);const c=String.fromCharCode(...i);return"undefined"!=typeof btoa?btoa(c):"undefined"!=typeof self?self.btoa(c):globalThis.btoa(c)}catch(t){throw new Error("데이터 암호화에 실패했습니다.")}}async function s(e){try{const t=await o(),n="undefined"!=typeof atob?atob(e):"undefined"!=typeof self?self.atob(e):globalThis.atob(e),r=Uint8Array.from(n,e=>e.charCodeAt(0)),a=r.slice(0,12),s=r.slice(12),i="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,c=await i.subtle.decrypt({name:"AES-GCM",iv:a},t,s);return(new TextDecoder).decode(c)}catch(t){throw new Error("데이터 복호화에 실패했습니다.")}}t(r,"providers",{gemini:new class extends n{constructor(){super(...arguments),t(this,"name","gemini")}async call(e,t,n){const r="tone-conversion"===t,o=this.buildPrompt(e,t,n.targetLanguage),a=`https://generativelanguage.googleapis.com/v1beta/models/${n.model}:generateContent?key=${n.apiKey}`,s={contents:[{parts:[{text:o}]}],generationConfig:{temperature:.7,maxOutputTokens:2048,candidateCount:1,topK:40,topP:.95,responseMimeType:r?"application/json":"text/plain"}},i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error(`Gemini API Error: ${i.status}`);return(await i.json()).candidates[0].content.parts[0].text}},chatgpt:new class extends n{constructor(){super(...arguments),t(this,"name","chatgpt")}async call(e,t,n){const r="tone-conversion"===t,o=this.buildPrompt(e,t,n.targetLanguage),a={model:n.model,messages:[{role:"user",content:o}],temperature:.7,max_tokens:2048,response_format:r?{type:"json_object"}:void 0},s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify(a)});if(!s.ok)throw new Error(`OpenAI API Error: ${s.status}`);return(await s.json()).choices[0].message.content}},claude:new class extends n{constructor(){super(...arguments),t(this,"name","claude")}async call(e,t,n){const r=this.buildPrompt(e,t,n.targetLanguage),o={model:n.model,max_tokens:2048,temperature:.7,messages:[{role:"user",content:r}]},a=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Claude API Error: ${a.status}`);return(await a.json()).content[0].text}}});export{r as A,s as d,a as e};
