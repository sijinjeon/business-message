# 기능 상세 스펙 문서 - 08. 유틸리티 함수

> **문서 버전**: 2.3 (2026 Update)
> **작성일**: 2026-01-01
> **업데이트**: 2026-01-01 - AIOrchestrator 및 번역 유틸리티 고도화 반영
> **담당 모듈**: `src/utils/`, `src/services/`

---

## 1. 개요 (v2.3)

비즈니스 로직의 파편화를 방지하기 위해 유틸리티 함수와 서비스 레이어를 명확히 분리하였습니다. AI 호출 관련 핵심 로직은 `src/services/ai/`로 이동되었으며, 기타 공통 기능은 `src/utils/`에서 관리합니다.

---

## 2. 주요 서비스 및 유틸리티

### 2.1 AI 서비스 (`src/services/ai/`)
- **AIOrchestrator**: 제공자별 API 호출 통합 및 응답 정규화.
- **BaseAIProvider**: 제공자별 어댑터의 기반 클래스.

### 2.2 번역 유틸리티 (`src/utils/translation.ts`)
- **translateText**: `AIOrchestrator`를 호출하여 번역 작업을 수행하는 고수준 함수.
- **quickDetectLanguage**: 정규식을 사용하여 입력 텍스트의 언어를 빠르게 감지 (ko, ja, zh, en).
- **getLanguageName**: 언어 코드를 사용자 친화적인 한글 명칭으로 변환.

### 2.3 스토리지 유틸리티 (`src/utils/storage.ts`)
- **logUsage**: AI 호출 후 토큰 사용량 및 비용을 계산하여 로그에 기록.
- **updateDailyUsage**: 일일 작업 횟수 업데이트 및 초기화 관리.
- **saveApiKey / getApiKey**: `crypto.ts`와 연동하여 안전한 키 관리 제공.

### 2.4 암호화 유틸리티 (`src/utils/crypto.ts`)
- **encryptData / decryptData**: AES-GCM 256-bit 기반의 데이터 보호.
- **PBKDF2**: 100,000회 반복을 통한 강력한 키 유도 기술 적용.

---

## 3. 설계 원칙 (v2.3)

- **Deep Merge**: `StorageService` 및 `storage.ts`에서 기본값과 기존 데이터 병합 시, `settings` 하위 객체(`translation`, `providerModels`)가 소실되지 않도록 깊은 병합 로직을 수행합니다.
- **Migration Logic**: 2026년 기준 모델 ID 변경 사항을 투명하게 처리하는 마이그레이션 코드를 포함합니다.

---

**문서 업데이트**: 2026-01-01
