# ğŸ“ í…ìŠ¤íŠ¸ ì„ íƒ ë³€í™˜ - íŒì—… ê²°ê³¼ í‘œì‹œ ê¸°ëŠ¥ ê°œë°œ ëª…ì„¸ì„œ

## 1. ê°œìš”

### 1.1 ìš”êµ¬ì‚¬í•­

**í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•œ í›„ ë‹¨ì¶•í‚¤ë¥¼ ëˆ„ë¥´ë©´, í™”ë©´ì—ì„œ ë°”ë¡œ ë¬¸ì¥ì„ ë³€ê²½í•˜ì§€ ì•Šê³  íŒì—…ì„ ë„ì›Œì„œ ë³€í™˜ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.**

#### í•µì‹¬ ê¸°ëŠ¥ 2ê°€ì§€

| ê¸°ëŠ¥ | ì„¤ëª… | ëª…ë ¹ì–´ ì´ë¦„ |
|------|------|-------------|
| **í†¤ ë³€í™˜** | ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ ì •ì¤‘í•œ ë¬¸ì¥ìœ¼ë¡œ ë³€í™˜ (ë¹„ì¦ˆë‹ˆìŠ¤/ì‚¬ë‚´/ìºì£¼ì–¼) | `instant-tone-conversion` |
| **ë²ˆì—­** | ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ ìë™ ë²ˆì—­ (í•œê¸€â†’ì˜ì–´, ë¹„í•œê¸€â†’í•œê¸€) | `instant-translation` |

> ğŸ’¡ **ë‹¨ì¶•í‚¤ ì„¤ì •**: ì‚¬ìš©ìê°€ `chrome://extensions/shortcuts`ì—ì„œ ì§ì ‘ ë‹¨ì¶•í‚¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

> âš ï¸ **í•µì‹¬ ë³€ê²½ì **: ê¸°ì¡´ì—ëŠ” ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ ì¦‰ì‹œ ëŒ€ì²´í–ˆìœ¼ë‚˜, ì´ì œëŠ” **ëª¨ë“  ê²½ìš°** íŒì—…ìœ¼ë¡œ ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

### 1.2 ë²ˆì—­ ê¸°ëŠ¥ ìƒì„¸ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥ ì–¸ì–´** | ìë™ ê°ì§€ (í•œê¸€/ë¹„í•œê¸€) |
| **ë„ì°©ì–´ ì˜µì…˜** | ì…ë ¥ì´ í•œê¸€ì´ë©´ ğŸ‡ºğŸ‡¸ ì˜ì–´ë¡œ ìë™ ì§€ì •, ì˜µì…˜: ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´, ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´<br>ì…ë ¥ì´ í•œê¸€ì´ ì•„ë‹ˆë©´ ğŸ‡°ğŸ‡· í•œê¸€ë¡œ ìë™ ì§€ì •, ì˜µì…˜ ì—†ìŒ |
| **ê¸°ë³¸ ì„¤ì •** | âœ… **ìë™ ë³€í™˜**<br>ì„ íƒ í…ìŠ¤íŠ¸ê°€ í•œê¸€ì´ë©´ ì˜ì–´ë¡œ, í•œê¸€ì´ ì•„ë‹ˆë©´ ë¬´ì¡°ê±´ í•œê¸€ë¡œ ë²ˆì—­ë¨ |
| **ê²°ê³¼ í‘œì‹œ** | íŒì—…ìœ¼ë¡œ ë²ˆì—­ ê²°ê³¼ í‘œì‹œ, ë³µì‚¬ ë²„íŠ¼ ì œê³µ<br>â€» ë²ˆì—­ í”Œë¡œìš°, íŒì—… UIì—ì„œë„ ë„ì°© ì–¸ì–´ ìë™ ì§€ì • ê·œì¹™ì´ ì¼ê´€ì ìœ¼ë¡œ ì ìš©ë¨ |

### 1.3 ì‚¬ìš©ì í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”„ í†¤ ë³€í™˜ í”Œë¡œìš°                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. í…ìŠ¤íŠ¸ ì„ íƒ â†’ 2. ë‹¨ì¶•í‚¤ ì‹¤í–‰ (ì‚¬ìš©ì ì„¤ì •)                    â”‚
â”‚  3. íŒì—… í‘œì‹œ (ë¡œë”©) â†’ 4. ì„¤ì •í•œ í†¤ ê²°ê³¼ë§Œ ìš°ì„  í‘œì‹œ         â”‚
â”‚     â†’ 5. ë‹¤ë¥¸ í†¤ì´ í•„ìš”í•˜ë©´ í•´ë‹¹ í†¤ ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ê³¼ í‘œì‹œ   â”‚
â”‚  5. í†¤ ì„ íƒ â†’ 6. "ë³µì‚¬" í´ë¦­ â†’ 7. Ctrl+V ë¶™ì—¬ë„£ê¸°                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ ë²ˆì—­ í”Œë¡œìš°                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. í…ìŠ¤íŠ¸ ì„ íƒ â†’ 2. ë‹¨ì¶•í‚¤ ì‹¤í–‰ (ì‚¬ìš©ì ì„¤ì •)                    â”‚
â”‚  3. ì–¸ì–´ ìë™ ê°ì§€ (í•œê¸€/ë¹„í•œê¸€)                                  â”‚
â”‚  4. í•œê¸€ì´ë©´ â†’ ì˜ì–´ë¡œ ë²ˆì—­ (ì˜µì…˜: ì¼ë³¸ì–´, ì¤‘êµ­ì–´)                 â”‚
â”‚     ë¹„í•œê¸€ì´ë©´ â†’ í•œê¸€ë¡œ ë²ˆì—­ (ì˜µì…˜ ì—†ìŒ)                          â”‚
â”‚  5. íŒì—…ì— ë²ˆì—­ ê²°ê³¼ í‘œì‹œ â†’ 6. "ë³µì‚¬" í´ë¦­ â†’ 7. Ctrl+V ë¶™ì—¬ë„£ê¸°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 íŒì—… UI êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–  BCA ë³€í™˜ íŒì—…                        [X] â”‚ â† í—¤ë” (ë“œë˜ê·¸ ê°€ëŠ¥)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì›ë³¸: "ì•ˆë…•í•˜ì„¸ìš”. ì˜¤ëŠ˜ ë¯¸íŒ… ì°¸ì„..."       â”‚ â† ì›ë³¸ í…ìŠ¤íŠ¸
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ í†¤ ë³€í™˜ ]  [ ë²ˆì—­ ]                       â”‚ â† ëª¨ë“œ íƒ­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ [í†¤ ë³€í™˜ ëª¨ë“œ]                               â”‚
â”‚ [ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤] [ğŸ¢ ì‚¬ë‚´] [ğŸ˜Š ìºì£¼ì–¼]          â”‚ â† í†¤ ì„ íƒ íƒ­
â”‚                                             â”‚
â”‚ [ë²ˆì—­ ëª¨ë“œ - í•œê¸€ ì…ë ¥ ì‹œ]                    â”‚
â”‚ [ğŸ‡ºğŸ‡¸ ì˜ì–´] [ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´] [ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´]           â”‚ â† ì–¸ì–´ ì„ íƒ íƒ­
â”‚                                             â”‚
â”‚ [ë²ˆì—­ ëª¨ë“œ - ë¹„í•œê¸€ ì…ë ¥ ì‹œ]                  â”‚
â”‚ ğŸ‡°ğŸ‡· í•œê¸€ë¡œ ìë™ ë²ˆì—­ (ì˜µì…˜ ì—†ìŒ)              â”‚ â† ì–¸ì–´ ê³ ì •
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ ë³€í™˜/ë²ˆì—­ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...        â”‚ â† ê²°ê³¼ ì˜ì—­
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       [ì·¨ì†Œ]       [ê²°ê³¼ ë³µì‚¬]              â”‚ â† ì•¡ì…˜ ë²„íŠ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### 2.1 í•µì‹¬ ê¸°ëŠ¥

| ID | ê¸°ëŠ¥ëª… | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|----|--------|------|----------|
| F-01 | í…ìŠ¤íŠ¸ ì„ íƒ ê°ì§€ | ëª¨ë“  DOM ìš”ì†Œì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ê°ì§€ | P0 |
| F-02 | í”Œë¡œíŒ… íŒì—… í‘œì‹œ | ì„ íƒ ì˜ì—­ ê·¼ì²˜ì— íŒì—… í‘œì‹œ | P0 |
| F-03 | ëª¨ë“œ ì „í™˜ | í†¤ ë³€í™˜ â†” ë²ˆì—­ ëª¨ë“œ ì „í™˜ | P0 |
| F-04 | **í†¤ ë³€í™˜** | ì„¤ì •í•œ í†¤ ìš°ì„  ë³€í™˜, ë‹¤ë¥¸ í†¤ì€ ìš”ì²­ ì‹œ ë³€í™˜ | P0 |
| F-05 | **ë²ˆì—­** | ìë™ ì–¸ì–´ ê°ì§€ ë²ˆì—­ (í•œê¸€â†’ì˜ì–´, ë¹„í•œê¸€â†’í•œê¸€) | P0 |
| F-06 | ì–¸ì–´ ìë™ ì„¤ì • | í•œê¸€ ì…ë ¥ ì‹œ ì˜ì–´ ê¸°ë³¸, ë¹„í•œê¸€ ì…ë ¥ ì‹œ í•œê¸€ ê³ ì • | P0 |
| F-07 | ê²°ê³¼ ë³µì‚¬ | ì„ íƒëœ ê²°ê³¼ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬ | P0 |
| F-08 | íŒì—… ë‹«ê¸° | ESC, ì™¸ë¶€ í´ë¦­, ì·¨ì†Œ ë²„íŠ¼ìœ¼ë¡œ ë‹«ê¸° | P1 |
| F-09 | ë“œë˜ê·¸ ì´ë™ | íŒì—… ìœ„ì¹˜ ë“œë˜ê·¸ë¡œ ì¡°ì • | P2 |

### 2.2 ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

| ID | ìš”êµ¬ì‚¬í•­ | ì„¤ëª… |
|----|----------|------|
| NF-01 | ìŠ¤íƒ€ì¼ ê²©ë¦¬ | Shadow DOMìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ì™€ ì™„ì „ ê²©ë¦¬ |
| NF-02 | ë°˜ì‘í˜• | í™”ë©´ í¬ê¸°ì— ë”°ë¼ íŒì—… ìœ„ì¹˜/í¬ê¸° ì¡°ì • |
| NF-03 | ì ‘ê·¼ì„± | í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, ARIA ì†ì„± ì ìš© |
| NF-04 | ì„±ëŠ¥ | Shadow DOM ì¬ì‚¬ìš©ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨í™” |
| NF-05 | **ìë™ í…ŒìŠ¤íŠ¸** | ê° ê°œë°œ ë‹¨ê³„ ì™„ë£Œ í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ |

---

## 3. ê¸°ìˆ  ìŠ¤í™

### 3.1 ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ì›¹ í˜ì´ì§€                                  â”‚
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  ì„ íƒëœ í…ìŠ¤íŠ¸   â”‚â”€â”€â”€â”€â–¶â”‚  í”Œë¡œíŒ… íŒì—… (Shadow DOM)               â”‚â”‚
â”‚   â”‚  "ì•ˆë…•í•˜ì„¸ìš”"    â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚ [í†¤ ë³€í™˜] [ë²ˆì—­]                    â”‚â”‚â”‚
â”‚          â”‚                â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚
â”‚          â”‚                â”‚  â”‚ í†¤: [ë¹„ì¦ˆë‹ˆìŠ¤][ì‚¬ë‚´][ìºì£¼ì–¼]        â”‚â”‚â”‚
â”‚          â”‚                â”‚  â”‚ ë²ˆì—­: ìë™ê°ì§€ (í•œê¸€â†’ì˜ì–´/ë¹„í•œê¸€â†’í•œê¸€) â”‚â”‚â”‚
â”‚          â–¼                â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚ ê²°ê³¼ í‘œì‹œ ì˜ì—­                      â”‚â”‚â”‚
â”‚   â”‚  Content Script â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                                                         â”‚
â”‚            â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚  Background     â”‚â—€â”€â”€â”€â”€â”€â”€ AI API â”€â”€â”€â”€â”€â”€â–¶ Claude/GPT/Gemini       â”‚
â”‚   â”‚  (commands.ts)  â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ index.ts                    # ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ (ìˆ˜ì •)
â”‚   â”œâ”€â”€ replacer.ts                 # ê¸°ì¡´ ëŒ€ì²´ ë¡œì§ (ìœ ì§€)
â”‚   â”œâ”€â”€ toast.ts                    # í† ìŠ¤íŠ¸ ì•Œë¦¼ (ê¸°ì¡´ ìœ ì§€)
â”‚   â””â”€â”€ floating-popup.ts           # â­ [ì‹ ê·œ] í”Œë¡œíŒ… íŒì—… ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ background/
â”‚   â””â”€â”€ commands.ts                 # â­ [ìˆ˜ì •] íŒì—… í‘œì‹œ ë¡œì§ìœ¼ë¡œ ë³€ê²½
â””â”€â”€ types/
    â””â”€â”€ content.ts                  # â­ [ì‹ ê·œ] Content Script íƒ€ì… ì •ì˜
```

### 3.3 ë©”ì‹œì§€ ì•¡ì…˜ ì •ì˜

| ì•¡ì…˜ëª… | ë°©í–¥ | ì„¤ëª… | Payload |
|--------|------|------|---------|
| `GET_SELECTED_TEXT` | Background â†’ Content | ì„ íƒëœ í…ìŠ¤íŠ¸ ìš”ì²­ | - |
| `SHOW_CONVERSION_POPUP` | Background â†’ Content | í†¤ ë³€í™˜ íŒì—… í‘œì‹œ | `{ originalText, mode: 'tone', selectionRect }` |
| `SHOW_TRANSLATION_POPUP` | Background â†’ Content | ë²ˆì—­ íŒì—… í‘œì‹œ | `{ originalText, mode: 'translation', selectionRect }` |
| `POPUP_SHOW_RESULT` | Background â†’ Content | ë³€í™˜ ê²°ê³¼ í‘œì‹œ | `{ results, mode }` |
| `POPUP_SHOW_ERROR` | Background â†’ Content | ì—ëŸ¬ í‘œì‹œ | `{ error: string }` |
| `HIDE_POPUP` | Background â†’ Content | íŒì—… ìˆ¨ê¹€ | - |

---

## 4. ìƒì„¸ êµ¬í˜„ ë‹¨ê³„ (Step-by-Step)

> ğŸ“Œ **ì¤‘ìš”**: ê° Phase ì™„ë£Œ í›„ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ í†µê³¼ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

---

### ğŸ“Œ Phase 1: íƒ€ì… ë° ê¸°ë°˜ êµ¬ì¡° (ì˜ˆìƒ ì†Œìš”: 2ì‹œê°„)

---

#### Step 1.1: íƒ€ì… ì •ì˜ íŒŒì¼ ìƒì„±

**íŒŒì¼:** `src/types/content.ts` (ì‹ ê·œ ìƒì„±)

```typescript
// src/types/content.ts

/**
 * íŒì—… ëª¨ë“œ
 */
export type PopupMode = 'tone' | 'translation';

/**
 * í†¤ íƒ€ì…
 */
export type ToneType = 'formal' | 'general' | 'friendly';

/**
 * ë²ˆì—­ ëŒ€ìƒ ì–¸ì–´
 * - í•œê¸€ ì…ë ¥ ì‹œ: en, ja, zh-CN ì„ íƒ ê°€ëŠ¥ (ê¸°ë³¸: en)
 * - ë¹„í•œê¸€ ì…ë ¥ ì‹œ: ko ê³ ì •
 */
export type TranslationLanguage = 'ko' | 'en' | 'ja' | 'zh-CN';

/**
 * í†¤ ë³€í™˜ ê²°ê³¼ íƒ€ì…
 */
export interface ToneConversionResult {
  formal: string;    // ë¹„ì¦ˆë‹ˆìŠ¤ í†¤
  general: string;   // ì‚¬ë‚´ í†¤
  friendly: string;  // ìºì£¼ì–¼ í†¤
}

/**
 * ë²ˆì—­ ê²°ê³¼ íƒ€ì…
 */
export interface TranslationResult {
  ko?: string;       // í•œê¸€
  en?: string;       // ì˜ì–´
  ja?: string;       // ì¼ë³¸ì–´
  'zh-CN'?: string;  // ì¤‘êµ­ì–´
}

/**
 * ì„ íƒ ì˜ì—­ ì •ë³´
 */
export interface SelectionRect {
  top: number;
  left: number;
  bottom: number;
  right: number;
  width: number;
  height: number;
}

/**
 * ì„ íƒëœ í…ìŠ¤íŠ¸ ì •ë³´ (GET_SELECTED_TEXT ì‘ë‹µ)
 */
export interface SelectionInfo {
  text: string;
  selectionRect: SelectionRect | null;
}

/**
 * í”Œë¡œíŒ… íŒì—… ì˜µì…˜
 */
export interface FloatingPopupOptions {
  position?: { x: number; y: number };
  mode: PopupMode;
  defaultTone?: ToneType;
  defaultLanguage?: TranslationLanguage;
}

/**
 * í”Œë¡œíŒ… íŒì—… ë©”ì‹œì§€ íƒ€ì…
 */
export type FloatingPopupAction = 
  | { action: 'SHOW_CONVERSION_POPUP'; originalText: string; mode: 'tone'; selectionRect?: SelectionRect }
  | { action: 'SHOW_TRANSLATION_POPUP'; originalText: string; mode: 'translation'; selectionRect?: SelectionRect }
  | { action: 'POPUP_SHOW_RESULT'; results: ToneConversionResult | TranslationResult; mode: PopupMode }
  | { action: 'POPUP_SHOW_ERROR'; error: string }
  | { action: 'HIDE_POPUP' };

/**
 * ì–¸ì–´ ë¼ë²¨ ë§¤í•‘
 */
export const LANGUAGE_LABELS: Record<TranslationLanguage, string> = {
  'ko': 'ğŸ‡°ğŸ‡· í•œê¸€',
  'en': 'ğŸ‡ºğŸ‡¸ ì˜ì–´',
  'ja': 'ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´',
  'zh-CN': 'ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´'
};

/**
 * í•œê¸€ ê°ì§€ ìœ í‹¸ë¦¬í‹°
 */
export function isKoreanText(text: string): boolean {
  const koreanRegex = /[\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F]/;
  return koreanRegex.test(text);
}

/**
 * í†¤ ë¼ë²¨ ë§¤í•‘
 */
export const TONE_LABELS: Record<ToneType, string> = {
  'formal': 'ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤',
  'general': 'ğŸ¢ ì‚¬ë‚´',
  'friendly': 'ğŸ˜Š ìºì£¼ì–¼'
};
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] íŒŒì¼ ìƒì„±
- [ ] `PopupMode` íƒ€ì… ì •ì˜
- [ ] `TranslationLanguage` íƒ€ì… ì •ì˜ (ko, en, ja, zh-CN)
- [ ] `isKoreanText()` í•œê¸€ ê°ì§€ í•¨ìˆ˜ ì •ì˜
- [ ] `ToneConversionResult` ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- [ ] `TranslationResult` ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- [ ] ë¼ë²¨ ë§¤í•‘ ìƒìˆ˜ ì •ì˜

---

#### Step 1.2: Phase 1 í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:**
```bash
cd /Users/sijin/Downloads/07.\ Cursor/business-message
npx tsc --noEmit
```

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| TypeScript ì»´íŒŒì¼ | íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ | â¬œ |
| import êµ¬ë¬¸ | ì •ìƒ ë™ì‘ | â¬œ |

**í†µê³¼ ê¸°ì¤€:** íƒ€ì… ì˜¤ë¥˜ 0ê°œ

---

### ğŸ“Œ Phase 2: í”Œë¡œíŒ… íŒì—… ì»´í¬ë„ŒíŠ¸ ê°œë°œ (ì˜ˆìƒ ì†Œìš”: 5ì‹œê°„)

---

#### Step 2.1: í”Œë¡œíŒ… íŒì—… CSS ì •ì˜

**íŒŒì¼:** `src/content/floating-popup.ts` ë‚´ë¶€ CSS ìƒìˆ˜

```typescript
const POPUP_STYLES = `
/* ì „ì²´ ì»¨í…Œì´ë„ˆ */
.bca-floating-popup {
  position: fixed;
  z-index: 2147483646;
  width: 450px;
  max-width: calc(100vw - 32px);
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 0 1px rgba(0, 0, 0, 0.05);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Pretendard', sans-serif;
  overflow: hidden;
  animation: bca-popup-enter 0.2s ease-out;
}

@keyframes bca-popup-enter {
  from { opacity: 0; transform: scale(0.95) translateY(-10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

/* í—¤ë” - ë“œë˜ê·¸ í•¸ë“¤ */
.bca-popup-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  background: #18181b;
  color: #fff;
  cursor: move;
  user-select: none;
}

.bca-popup-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  font-weight: 600;
}

.bca-popup-close {
  width: 28px;
  height: 28px;
  border: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s;
}

.bca-popup-close:hover {
  background: rgba(255,255,255,0.2);
}

/* ì›ë³¸ í…ìŠ¤íŠ¸ */
.bca-original-section {
  padding: 14px 16px;
  background: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
}

.bca-original-label {
  font-size: 11px;
  font-weight: 700;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.bca-original-text {
  font-size: 13px;
  color: #374151;
  line-height: 1.5;
  max-height: 80px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
}

/* ëª¨ë“œ íƒ­ (í†¤ ë³€í™˜ / ë²ˆì—­) */
.bca-mode-tabs {
  display: flex;
  padding: 10px 16px;
  gap: 8px;
  border-bottom: 1px solid #e5e7eb;
  background: #fafafa;
}

.bca-mode-tab {
  flex: 1;
  padding: 10px 16px;
  border: none;
  background: #fff;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 600;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.15s;
  border: 1px solid #e5e7eb;
}

.bca-mode-tab:hover {
  background: #f3f4f6;
  color: #374151;
}

.bca-mode-tab.active {
  background: #18181b;
  color: #fff;
  border-color: #18181b;
}

/* ì˜µì…˜ íƒ­ (í†¤ ì„ íƒ / ì–¸ì–´ ì„ íƒ) */
.bca-option-tabs {
  display: flex;
  padding: 10px 16px;
  gap: 6px;
  border-bottom: 1px solid #e5e7eb;
}

.bca-option-tab {
  flex: 1;
  padding: 10px 12px;
  border: none;
  background: #f3f4f6;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.15s;
}

.bca-option-tab:hover {
  background: #e5e7eb;
  color: #374151;
}

.bca-option-tab.active {
  background: #3b82f6;
  color: #fff;
}

.bca-option-tab:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ê²°ê³¼ ì˜ì—­ */
.bca-result-section {
  padding: 16px;
  min-height: 120px;
  max-height: 220px;
  overflow-y: auto;
}

.bca-result-text {
  font-size: 15px;
  line-height: 1.7;
  color: #111827;
  white-space: pre-wrap;
  word-break: break-word;
}

/* ë¡œë”© ìƒíƒœ */
.bca-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  gap: 16px;
}

.bca-spinner {
  width: 36px;
  height: 36px;
  border: 3px solid #e5e7eb;
  border-top-color: #18181b;
  border-radius: 50%;
  animation: bca-spin 0.8s linear infinite;
}

@keyframes bca-spin {
  to { transform: rotate(360deg); }
}

.bca-loading-text {
  font-size: 14px;
  color: #6b7280;
}

/* ì—ëŸ¬ ìƒíƒœ */
.bca-error {
  margin: 16px;
  padding: 14px 16px;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 10px;
}

.bca-error-text {
  font-size: 14px;
  color: #dc2626;
}

/* í‘¸í„° ì•¡ì…˜ */
.bca-popup-footer {
  display: flex;
  padding: 14px 16px;
  gap: 10px;
  border-top: 1px solid #e5e7eb;
  background: #f9fafb;
}

.bca-btn {
  flex: 1;
  padding: 12px 18px;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.bca-btn-primary {
  background: #18181b;
  color: #fff;
}

.bca-btn-primary:hover {
  background: #27272a;
}

.bca-btn-primary.copied {
  background: #22c55e;
}

.bca-btn-secondary {
  background: #fff;
  color: #374151;
  border: 1px solid #d1d5db;
}

.bca-btn-secondary:hover {
  background: #f3f4f6;
}
`;
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] ëª¨ë“œ íƒ­ ìŠ¤íƒ€ì¼ ì¶”ê°€ (`.bca-mode-tabs`)
- [ ] ì˜µì…˜ íƒ­ ìŠ¤íƒ€ì¼ ì¶”ê°€ (`.bca-option-tabs`)
- [ ] ì–¸ì–´ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼

---

#### Step 2.2: í”Œë¡œíŒ… íŒì—… í´ë˜ìŠ¤ êµ¬í˜„

**íŒŒì¼:** `src/content/floating-popup.ts` (ì‹ ê·œ ìƒì„±)

```typescript
// src/content/floating-popup.ts

import type { 
  PopupMode, 
  ToneType, 
  TranslationLanguage, 
  ToneConversionResult, 
  TranslationResult,
  FloatingPopupOptions 
} from '../types/content';

const POPUP_STYLES = `/* Step 2.1ì˜ CSS */`;

/**
 * BCA í”Œë¡œíŒ… ë³€í™˜/ë²ˆì—­ íŒì—…
 * Shadow DOMìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ì™€ ì™„ì „ ê²©ë¦¬
 */
class FloatingConversionPopup {
  private shadowHost: HTMLDivElement | null = null;
  private shadowRoot: ShadowRoot | null = null;
  private popupElement: HTMLDivElement | null = null;
  
  private originalText: string = '';
  private mode: PopupMode = 'tone';
  
  // í†¤ ë³€í™˜ ê´€ë ¨ (â­ ê°œë³„ í†¤ ê²°ê³¼ ì €ì¥, lazy loading)
  private toneResults: Partial<ToneConversionResult> = {};
  private selectedTone: ToneType = 'formal';
  private isConverting: Record<ToneType, boolean> = { formal: false, general: false, friendly: false };
  
  // ë²ˆì—­ ê´€ë ¨
  private translationResults: TranslationResult = {};
  private selectedLanguage: TranslationLanguage = 'en';
  private isKoreanInput: boolean = true;  // â­ í•œê¸€ ì…ë ¥ ì—¬ë¶€
  private isTranslating: Record<TranslationLanguage, boolean> = { ko: false, en: false, ja: false, 'zh-CN': false };
  
  private isDragging: boolean = false;
  private dragOffset = { x: 0, y: 0 };
  
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì°¸ì¡°
  private boundHandleKeyDown: (e: KeyboardEvent) => void;
  private boundHandleOutsideClick: (e: MouseEvent) => void;
  private boundHandleDrag: (e: MouseEvent) => void;
  private boundHandleDragEnd: () => void;

  constructor() {
    this.boundHandleKeyDown = this.handleKeyDown.bind(this);
    this.boundHandleOutsideClick = this.handleOutsideClick.bind(this);
    this.boundHandleDrag = this.handleDrag.bind(this);
    this.boundHandleDragEnd = this.handleDragEnd.bind(this);
  }

  /**
   * íŒì—… í‘œì‹œ (ë¡œë”© ìƒíƒœë¡œ ì‹œì‘)
   */
  public show(originalText: string, options: FloatingPopupOptions): void {
    this.originalText = originalText;
    this.mode = options.mode;
    this.selectedTone = options.defaultTone || 'formal';
    // â­ ì–¸ì–´ ìë™ ê°ì§€: í•œê¸€ì´ë©´ ì˜ì–´ë¡œ, ë¹„í•œê¸€ì´ë©´ í•œê¸€ë¡œ
    this.isKoreanInput = isKoreanText(originalText);
    this.selectedLanguage = this.isKoreanInput ? 'en' : 'ko';
    this.toneResults = {};
    this.isConverting = { formal: false, general: false, friendly: false };
    this.translationResults = {};
    
    this.createPopup(options.position);
    this.showLoading();
    this.attachEventListeners();
  }

  /**
   * ë¡œë”© ìƒíƒœ í‘œì‹œ
   */
  public showLoading(): void {
    if (!this.popupElement) return;
    
    const resultSection = this.popupElement.querySelector('.bca-result-section');
    if (resultSection) {
      const loadingText = this.mode === 'tone' ? 'AIê°€ í†¤ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...' : 'AIê°€ ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤...';
      resultSection.innerHTML = `
        <div class="bca-loading">
          <div class="bca-spinner"></div>
          <div class="bca-loading-text">${loadingText}</div>
        </div>
      `;
    }
    
    this.setOptionsDisabled(true);
  }

  /**
   * í†¤ ë³€í™˜ ê²°ê³¼ í‘œì‹œ (â­ ê°œë³„ í†¤ ê²°ê³¼)
   */
  public showToneResult(tone: ToneType, result: string): void {
    this.toneResults[tone] = result;
    this.isConverting[tone] = false;
    this.mode = 'tone';
    this.updateModeUI();
    this.updateResultDisplay();
    this.setOptionsDisabled(false);
  }

  /**
   * ë²ˆì—­ ê²°ê³¼ í‘œì‹œ
   */
  public showTranslationResult(language: TranslationLanguage, translatedText: string): void {
    this.translationResults[language] = translatedText;
    this.isTranslating[language] = false;
    this.mode = 'translation';
    this.updateModeUI();
    this.updateResultDisplay();
    this.setOptionsDisabled(false);
  }

  /**
   * ì—ëŸ¬ í‘œì‹œ
   */
  public showError(message: string): void {
    if (!this.popupElement) return;
    
    const resultSection = this.popupElement.querySelector('.bca-result-section');
    if (resultSection) {
      resultSection.innerHTML = `
        <div class="bca-error">
          <div class="bca-error-text">âŒ ${message}</div>
        </div>
      `;
    }
    
    this.setOptionsDisabled(true);
  }

  /**
   * íŒì—… ìˆ¨ê¸°ê¸°
   */
  public hide(): void {
    this.detachEventListeners();
    
    if (this.shadowHost && this.shadowHost.parentNode) {
      this.shadowHost.parentNode.removeChild(this.shadowHost);
    }
    
    this.shadowHost = null;
    this.shadowRoot = null;
    this.popupElement = null;
    this.toneResults = {};
    this.translationResults = {};
  }

  /**
   * í˜„ì¬ ëª¨ë“œ ë°˜í™˜
   */
  public getMode(): PopupMode {
    return this.mode;
  }

  /**
   * í˜„ì¬ ì„ íƒëœ ì–¸ì–´ ë°˜í™˜
   */
  public getSelectedLanguage(): TranslationLanguage {
    return this.selectedLanguage;
  }

  // === Private Methods ===

  private createPopup(position?: { x: number; y: number }): void {
    this.hide();
    
    this.shadowHost = document.createElement('div');
    this.shadowHost.id = 'bca-floating-popup-host';
    this.shadowHost.style.cssText = 'all: initial; position: fixed; z-index: 2147483647;';
    
    this.shadowRoot = this.shadowHost.attachShadow({ mode: 'closed' });
    
    const styleEl = document.createElement('style');
    styleEl.textContent = POPUP_STYLES;
    this.shadowRoot.appendChild(styleEl);
    
    this.popupElement = document.createElement('div');
    this.popupElement.className = 'bca-floating-popup';
    this.popupElement.innerHTML = this.getPopupHTML();
    
    const pos = position || this.getDefaultPosition();
    this.popupElement.style.left = `${pos.x}px`;
    this.popupElement.style.top = `${pos.y}px`;
    
    this.shadowRoot.appendChild(this.popupElement);
    document.body.appendChild(this.shadowHost);
    
    this.bindInternalEvents();
  }

  private getPopupHTML(): string {
    const truncatedText = this.originalText.length > 200 
      ? this.originalText.slice(0, 200) + '...' 
      : this.originalText;
    
    return `
      <div class="bca-popup-header">
        <div class="bca-popup-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
          <span>BCA ë³€í™˜</span>
        </div>
        <button class="bca-popup-close" data-action="close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="bca-original-section">
        <div class="bca-original-label">ì›ë³¸ í…ìŠ¤íŠ¸</div>
        <div class="bca-original-text">${this.escapeHtml(truncatedText)}</div>
      </div>
      
      <!-- ëª¨ë“œ íƒ­ -->
      <div class="bca-mode-tabs">
        <button class="bca-mode-tab ${this.mode === 'tone' ? 'active' : ''}" data-mode="tone">
          âœ¨ í†¤ ë³€í™˜
        </button>
        <button class="bca-mode-tab ${this.mode === 'translation' ? 'active' : ''}" data-mode="translation">
          ğŸŒ ë²ˆì—­
        </button>
      </div>
      
      <!-- ì˜µì…˜ íƒ­ (í†¤ or ì–¸ì–´) -->
      <div class="bca-option-tabs" id="option-tabs">
        ${this.getOptionTabsHTML()}
      </div>
      
      <div class="bca-result-section">
        <div class="bca-loading">
          <div class="bca-spinner"></div>
          <div class="bca-loading-text">AIê°€ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
      </div>
      
      <div class="bca-popup-footer">
        <button class="bca-btn bca-btn-secondary" data-action="cancel">ì·¨ì†Œ</button>
        <button class="bca-btn bca-btn-primary" data-action="copy">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
          </svg>
          ê²°ê³¼ ë³µì‚¬
        </button>
      </div>
    `;
  }

  private getOptionTabsHTML(): string {
    if (this.mode === 'tone') {
      return `
        <button class="bca-option-tab ${this.selectedTone === 'formal' ? 'active' : ''}" data-tone="formal">ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤</button>
        <button class="bca-option-tab ${this.selectedTone === 'general' ? 'active' : ''}" data-tone="general">ğŸ¢ ì‚¬ë‚´</button>
        <button class="bca-option-tab ${this.selectedTone === 'friendly' ? 'active' : ''}" data-tone="friendly">ğŸ˜Š ìºì£¼ì–¼</button>
      `;
    } else {
      // â­ í•œê¸€ ì…ë ¥ì´ë©´ ì˜ì–´/ì¼ë³¸ì–´/ì¤‘êµ­ì–´ ì„ íƒ ê°€ëŠ¥, ë¹„í•œê¸€ì´ë©´ í•œê¸€ ê³ ì •
      if (this.isKoreanInput) {
        return `
          <button class="bca-option-tab ${this.selectedLanguage === 'en' ? 'active' : ''}" data-lang="en">ğŸ‡ºğŸ‡¸ ì˜ì–´</button>
          <button class="bca-option-tab ${this.selectedLanguage === 'ja' ? 'active' : ''}" data-lang="ja">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´</button>
          <button class="bca-option-tab ${this.selectedLanguage === 'zh-CN' ? 'active' : ''}" data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´</button>
        `;
      } else {
        return `
          <button class="bca-option-tab active" data-lang="ko" disabled>ğŸ‡°ğŸ‡· í•œê¸€ (ìë™)</button>
        `;
      }
    }
  }

  private bindInternalEvents(): void {
    if (!this.popupElement) return;
    
    // ë‹«ê¸°/ì·¨ì†Œ ë²„íŠ¼
    this.popupElement.querySelector('[data-action="close"]')?.addEventListener('click', () => this.hide());
    this.popupElement.querySelector('[data-action="cancel"]')?.addEventListener('click', () => this.hide());
    
    // ë³µì‚¬ ë²„íŠ¼
    this.popupElement.querySelector('[data-action="copy"]')?.addEventListener('click', () => this.copySelectedText());
    
    // ëª¨ë“œ íƒ­
    this.popupElement.querySelectorAll('.bca-mode-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        const mode = (e.currentTarget as HTMLElement).dataset.mode as PopupMode;
        this.switchMode(mode);
      });
    });
    
    // ì˜µì…˜ íƒ­ (í†¤/ì–¸ì–´)
    this.bindOptionTabEvents();
    
    // í—¤ë” ë“œë˜ê·¸
    this.popupElement.querySelector('.bca-popup-header')?.addEventListener('mousedown', (e) => this.handleDragStart(e as MouseEvent));
  }

  private bindOptionTabEvents(): void {
    // í†¤ íƒ­
    this.popupElement?.querySelectorAll('[data-tone]').forEach(tab => {
      tab.addEventListener('click', (e) => {
        const tone = (e.currentTarget as HTMLElement).dataset.tone as ToneType;
        this.selectTone(tone);
      });
    });
    
    // ì–¸ì–´ íƒ­
    this.popupElement?.querySelectorAll('[data-lang]').forEach(tab => {
      tab.addEventListener('click', (e) => {
        const lang = (e.currentTarget as HTMLElement).dataset.lang as TranslationLanguage;
        this.selectLanguage(lang);
      });
    });
  }

  private switchMode(mode: PopupMode): void {
    this.mode = mode;
    this.updateModeUI();
    this.updateOptionTabs();
    this.updateResultDisplay();
  }

  private updateModeUI(): void {
    this.popupElement?.querySelectorAll('.bca-mode-tab').forEach(tab => {
      tab.classList.toggle('active', tab.getAttribute('data-mode') === this.mode);
    });
  }

  private updateOptionTabs(): void {
    const optionTabs = this.popupElement?.querySelector('#option-tabs');
    if (optionTabs) {
      optionTabs.innerHTML = this.getOptionTabsHTML();
      this.bindOptionTabEvents();
    }
  }

  private selectTone(tone: ToneType): void {
    this.selectedTone = tone;
    this.popupElement?.querySelectorAll('[data-tone]').forEach(tab => {
      tab.classList.toggle('active', tab.getAttribute('data-tone') === tone);
    });
    
    // â­ í•´ë‹¹ í†¤ì˜ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë³€í™˜ ìš”ì²­
    if (!this.toneResults[tone]) {
      this.requestToneConversion(tone);
    } else {
      this.updateResultDisplay();
    }
  }

  // â­ ì¶”ê°€ í†¤ ë³€í™˜ ìš”ì²­ (ë‹¤ë¥¸ í†¤ ì„ íƒ ì‹œ)
  private requestToneConversion(tone: ToneType): void {
    // ì´ë¯¸ ë³€í™˜ ì¤‘ì´ë©´ ë¬´ì‹œ
    if (this.isConverting[tone]) return;
    
    this.isConverting[tone] = true;
    
    // Backgroundì— í†¤ ë³€í™˜ ìš”ì²­ ë©”ì‹œì§€ ì „ì†¡
    chrome.runtime.sendMessage({
      action: 'REQUEST_TONE_CONVERSION',
      text: this.originalText,
      tone: tone
    });
    
    // ë¡œë”© í‘œì‹œ
    const resultSection = this.popupElement?.querySelector('.bca-result-section');
    if (resultSection) {
      resultSection.innerHTML = `
        <div class="bca-loading">
          <div class="bca-spinner"></div>
          <div class="bca-loading-text">í†¤ ë³€í™˜ ì¤‘...</div>
        </div>
      `;
    }
  }

  private selectLanguage(lang: TranslationLanguage): void {
    this.selectedLanguage = lang;
    this.popupElement?.querySelectorAll('[data-lang]').forEach(tab => {
      tab.classList.toggle('active', tab.getAttribute('data-lang') === lang);
    });
    
    // í•´ë‹¹ ì–¸ì–´ì˜ ë²ˆì—­ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë²ˆì—­ ìš”ì²­
    if (!this.translationResults[lang]) {
      this.requestTranslation(lang);
    } else {
      this.updateResultDisplay();
    }
  }

  private requestTranslation(lang: TranslationLanguage): void {
    // ì´ë¯¸ ë²ˆì—­ ì¤‘ì´ë©´ ë¬´ì‹œ
    if (this.isTranslating[lang]) return;
    
    this.isTranslating[lang] = true;
    
    // Backgroundì— ë²ˆì—­ ìš”ì²­ ë©”ì‹œì§€ ì „ì†¡
    chrome.runtime.sendMessage({
      action: 'REQUEST_TRANSLATION',
      text: this.originalText,
      targetLanguage: lang
    });
    
    // ë¡œë”© í‘œì‹œ
    const resultSection = this.popupElement?.querySelector('.bca-result-section');
    if (resultSection) {
      resultSection.innerHTML = `
        <div class="bca-loading">
          <div class="bca-spinner"></div>
          <div class="bca-loading-text">ë²ˆì—­ ì¤‘...</div>
        </div>
      `;
    }
  }

  private updateResultDisplay(): void {
    if (!this.popupElement) return;
    
    const resultSection = this.popupElement.querySelector('.bca-result-section');
    if (!resultSection) return;
    
    let text = '';
    
    if (this.mode === 'tone') {
      text = this.toneResults[this.selectedTone] || '';
    } else {
      text = this.translationResults[this.selectedLanguage] || '';
    }
    
    if (text) {
      resultSection.innerHTML = `<div class="bca-result-text">${this.escapeHtml(text)}</div>`;
    } else {
      resultSection.innerHTML = `
        <div class="bca-loading">
          <div class="bca-spinner"></div>
          <div class="bca-loading-text">ì²˜ë¦¬ ì¤‘...</div>
        </div>
      `;
    }
  }

  private async copySelectedText(): Promise<void> {
    let text = '';
    
    if (this.mode === 'tone') {
      text = this.toneResults[this.selectedTone] || '';
    } else {
      text = this.translationResults[this.selectedLanguage] || '';
    }
    
    if (!text) return;
    
    try {
      await navigator.clipboard.writeText(text);
      
      const copyBtn = this.popupElement?.querySelector('[data-action="copy"]');
      if (copyBtn) {
        copyBtn.classList.add('copied');
        copyBtn.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          ë³µì‚¬ë¨!
        `;
        
        setTimeout(() => {
          copyBtn.classList.remove('copied');
          copyBtn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
            </svg>
            ê²°ê³¼ ë³µì‚¬
          `;
        }, 2000);
      }
    } catch (error) {
      console.error('[BCA] Copy failed:', error);
    }
  }

  private setOptionsDisabled(disabled: boolean): void {
    this.popupElement?.querySelectorAll('.bca-option-tab').forEach(tab => {
      (tab as HTMLButtonElement).disabled = disabled;
    });
  }

  private getDefaultPosition(): { x: number; y: number } {
    return {
      x: (window.innerWidth - 450) / 2,
      y: (window.innerHeight - 450) / 2
    };
  }

  private escapeHtml(text: string): string {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // === Event Handlers ===

  private attachEventListeners(): void {
    document.addEventListener('keydown', this.boundHandleKeyDown);
    document.addEventListener('mousedown', this.boundHandleOutsideClick);
  }

  private detachEventListeners(): void {
    document.removeEventListener('keydown', this.boundHandleKeyDown);
    document.removeEventListener('mousedown', this.boundHandleOutsideClick);
    document.removeEventListener('mousemove', this.boundHandleDrag);
    document.removeEventListener('mouseup', this.boundHandleDragEnd);
  }

  private handleKeyDown(e: KeyboardEvent): void {
    if (e.key === 'Escape') this.hide();
  }

  private handleOutsideClick(e: MouseEvent): void {
    if (!this.shadowHost) return;
    if (!this.shadowHost.contains(e.target as Node)) {
      setTimeout(() => { if (this.shadowHost) this.hide(); }, 50);
    }
  }

  private handleDragStart(e: MouseEvent): void {
    if (!this.popupElement) return;
    this.isDragging = true;
    const rect = this.popupElement.getBoundingClientRect();
    this.dragOffset = { x: e.clientX - rect.left, y: e.clientY - rect.top };
    document.addEventListener('mousemove', this.boundHandleDrag);
    document.addEventListener('mouseup', this.boundHandleDragEnd);
    e.preventDefault();
  }

  private handleDrag(e: MouseEvent): void {
    if (!this.isDragging || !this.popupElement) return;
    const newX = e.clientX - this.dragOffset.x;
    const newY = e.clientY - this.dragOffset.y;
    const maxX = window.innerWidth - this.popupElement.offsetWidth;
    const maxY = window.innerHeight - this.popupElement.offsetHeight;
    this.popupElement.style.left = `${Math.max(0, Math.min(newX, maxX))}px`;
    this.popupElement.style.top = `${Math.max(0, Math.min(newY, maxY))}px`;
  }

  private handleDragEnd(): void {
    this.isDragging = false;
    document.removeEventListener('mousemove', this.boundHandleDrag);
    document.removeEventListener('mouseup', this.boundHandleDragEnd);
  }
}

// ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ export
export const floatingPopup = new FloatingConversionPopup();
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] `PopupMode` ì§€ì› (tone/translation)
- [ ] ëª¨ë“œ íƒ­ ì „í™˜ ê¸°ëŠ¥
- [ ] í†¤ ì„ íƒ íƒ­ (formal/general/friendly)
- [ ] **í†¤ lazy loading** (ì„¤ì • í†¤ ìš°ì„  í‘œì‹œ, ë‹¤ë¥¸ í†¤ì€ ìš”ì²­ ì‹œ ë³€í™˜)
- [ ] `requestToneConversion()` ì¶”ê°€ í†¤ ìš”ì²­ í•¨ìˆ˜
- [ ] í†¤ ê²°ê³¼ ìºì‹± (í†¤ë³„)
- [ ] ì–¸ì–´ ì„ íƒ íƒ­ (í•œê¸€ ì…ë ¥: en/ja/zh-CN, ë¹„í•œê¸€ ì…ë ¥: ko ê³ ì •)
- [ ] **ì–¸ì–´ ìë™ ê°ì§€ ë° ê¸°ë³¸ ì„¤ì •** (í•œê¸€â†’ì˜ì–´, ë¹„í•œê¸€â†’í•œê¸€)
- [ ] ë²ˆì—­ ê²°ê³¼ ìºì‹± (ì–¸ì–´ë³„)
- [ ] ë™ì  ë²ˆì—­ ìš”ì²­ ê¸°ëŠ¥

---

#### Step 2.3: Phase 2 í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:**
```bash
cd /Users/sijin/Downloads/07.\ Cursor/business-message
npx tsc --noEmit && npm run build
```

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| TypeScript ì»´íŒŒì¼ | íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ | â¬œ |
| Vite ë¹Œë“œ | ë¹Œë“œ ì„±ê³µ | â¬œ |
| ë²ˆë“¤ ìƒì„± | dist í´ë”ì— íŒŒì¼ ìƒì„± | â¬œ |

**í†µê³¼ ê¸°ì¤€:** ë¹Œë“œ ì˜¤ë¥˜ 0ê°œ

---

### ğŸ“Œ Phase 3: Background Script ìˆ˜ì • (ì˜ˆìƒ ì†Œìš”: 3ì‹œê°„)

---

#### Step 3.1: handleInstantToneConversion í•¨ìˆ˜ ìˆ˜ì •

**íŒŒì¼:** `src/background/commands.ts` (ìˆ˜ì •)

```typescript
/**
 * ì¦‰ì‹œ í†¤ ë³€í™˜ ì²˜ë¦¬ - íŒì—…ìœ¼ë¡œ ê²°ê³¼ í‘œì‹œ
 */
async function handleInstantToneConversion() {
  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
  if (!tab?.id) return;

  if (tab.url?.startsWith('chrome://') || tab.url?.startsWith('edge://') || tab.url?.startsWith('about:')) {
    return;
  }

  try {
    const response = await safeSendMessage(tab.id, { action: 'GET_SELECTED_TEXT' });
    
    if (response === null) {
      chrome.notifications.create({
        type: 'basic',
        iconUrl: 'images/icon48.png',
        title: 'BCA ì•Œë¦¼',
        message: 'í˜„ì¬ í˜ì´ì§€ì—ì„œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      });
      return;
    }

    const text = response.text;
    if (!text?.trim()) {
      await safeSendMessage(tab.id, {
        action: 'SHOW_TOAST',
        message: 'ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.',
        type: 'info'
      });
      return;
    }

    // AI ë³€í™˜ ì‹¤í–‰ì„ ìœ„í•œ ì„¤ì • ë¡œë“œ
    const data = await getStorageData();
    const { settings, apiKeys } = data;
    const provider = settings.selectedProvider;
    const model = settings.providerModels[provider];
    const encryptedKey = apiKeys[provider];

    if (!encryptedKey) {
      await safeSendMessage(tab.id, {
        action: 'POPUP_SHOW_ERROR',
        error: `${provider} API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`
      });
      return;
    }

    // â­ ì„¤ì •ëœ ê¸°ë³¸ í†¤ ê°€ì ¸ì˜¤ê¸°
    const defaultTone = settings.autoCopyTone || 'formal';

    // â­ í†¤ ë³€í™˜ íŒì—… í‘œì‹œ (ê¸°ë³¸ í†¤ ì •ë³´ í¬í•¨)
    await safeSendMessage(tab.id, {
      action: 'SHOW_CONVERSION_POPUP',
      originalText: text,
      mode: 'tone',
      defaultTone: defaultTone,  // â­ ê¸°ë³¸ í†¤ ì „ë‹¬
      selectionRect: response.selectionRect
    });

    const apiKey = await decryptData(encryptedKey);
    
    // â­ ì„¤ì •ëœ í†¤ë§Œ ìš°ì„  ë³€í™˜ (3ê°€ì§€ ë™ì‹œ ë³€í™˜ X)
    const result = await AIOrchestrator.execute(text, 'tone-conversion', {
      provider, model, apiKey,
      tone: defaultTone  // â­ ì„¤ì •ëœ í†¤ë§Œ ë³€í™˜
    }) as AIApiResponse;

    await safeSendMessage(tab.id, {
      action: 'POPUP_SHOW_TONE_RESULT',
      tone: defaultTone,
      result: result[defaultTone]  // â­ í•´ë‹¹ í†¤ ê²°ê³¼ë§Œ ì „ë‹¬
    });

    await logUsage({
      provider, model,
      task: 'tone-conversion',
      inputTokens: Math.ceil(text.length * 0.75),
      outputTokens: Math.ceil(JSON.stringify(result).length * 0.75)
    });

  } catch (error: any) {
    console.error('[BCA] Instant Tone Conversion Error:', error);
    if (tab?.id) {
      await safeSendMessage(tab.id, {
        action: 'POPUP_SHOW_ERROR',
        error: error.message || 'ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
      });
    }
  }
}
```

---

#### Step 3.2: handleInstantTranslation í•¨ìˆ˜ ìˆ˜ì •

**íŒŒì¼:** `src/background/commands.ts` (ìˆ˜ì •)

```typescript
/**
 * ì¦‰ì‹œ ë²ˆì—­ ì²˜ë¦¬ - íŒì—…ìœ¼ë¡œ ê²°ê³¼ í‘œì‹œ (ì–¸ì–´ ìë™ ê°ì§€)
 */
async function handleInstantTranslation() {
  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
  if (!tab?.id) return;

  if (tab.url?.startsWith('chrome://') || tab.url?.startsWith('edge://') || tab.url?.startsWith('about:')) {
    return;
  }

  try {
    const response = await safeSendMessage(tab.id, { action: 'GET_SELECTED_TEXT' });
    
    if (response === null) {
      chrome.notifications.create({
        type: 'basic',
        iconUrl: 'images/icon48.png',
        title: 'BCA ì•Œë¦¼',
        message: 'í˜„ì¬ í˜ì´ì§€ì—ì„œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      });
      return;
    }

    const text = response.text;
    if (!text?.trim()) {
      await safeSendMessage(tab.id, {
        action: 'SHOW_TOAST',
        message: 'ë²ˆì—­í•  í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.',
        type: 'info'
      });
      return;
    }

    // â­ í•œê¸€ ì—¬ë¶€ ìë™ ê°ì§€
    const isKorean = isKoreanText(text);
    const targetLanguage = isKorean ? 'en' : 'ko';  // í•œê¸€â†’ì˜ì–´, ë¹„í•œê¸€â†’í•œê¸€

    // â­ ë²ˆì—­ íŒì—… í‘œì‹œ (ì–¸ì–´ ìë™ ì„¤ì •)
    await safeSendMessage(tab.id, {
      action: 'SHOW_TRANSLATION_POPUP',
      originalText: text,
      mode: 'translation',
      isKoreanInput: isKorean,
      selectionRect: response.selectionRect
    });

    // AI ë²ˆì—­ ì‹¤í–‰ (ìë™ ê°ì§€ëœ ì–¸ì–´ë¡œ)
    const data = await getStorageData();
    const { settings, apiKeys } = data;

    const result = await translateText(text, targetLanguage, settings, apiKeys);

    if (result.success) {
      await safeSendMessage(tab.id, {
        action: 'POPUP_SHOW_TRANSLATION_RESULT',
        language: targetLanguage,
        translatedText: result.translatedText
      });
      
      await logUsage({
        provider: settings.selectedProvider,
        model: settings.providerModels[settings.selectedProvider],
        task: 'translation',
        inputTokens: Math.ceil(text.length * 0.75),
        outputTokens: Math.ceil(result.translatedText.length * 0.75)
      });
    } else {
      await safeSendMessage(tab.id, {
        action: 'POPUP_SHOW_ERROR',
        error: result.error || 'ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
      });
    }

  } catch (error: any) {
    console.error('[BCA] Instant Translation Error:', error);
    if (tab?.id) {
      await safeSendMessage(tab.id, {
        action: 'POPUP_SHOW_ERROR',
        error: error.message || 'ë²ˆì—­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
      });
    }
  }
}

/**
 * í•œê¸€ í…ìŠ¤íŠ¸ ê°ì§€
 */
function isKoreanText(text: string): boolean {
  const koreanRegex = /[\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F]/;
  return koreanRegex.test(text);
}
```

---

#### Step 3.3: ì¶”ê°€ ìš”ì²­ í•¸ë“¤ëŸ¬ (í†¤ ë³€í™˜ / ë²ˆì—­)

**íŒŒì¼:** `src/background/index.ts` (ì¶”ê°€)

```typescript
// ëŸ°íƒ€ì„ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆì— ì¶”ê°€
chrome.runtime.onMessage.addListener((request, _sender, sendResponse) => {
  // ... ê¸°ì¡´ ì½”ë“œ

  // â­ ì¶”ê°€ í†¤ ë³€í™˜ ìš”ì²­ (íŒì—…ì—ì„œ ë‹¤ë¥¸ í†¤ ì„ íƒ ì‹œ)
  if (request.action === 'REQUEST_TONE_CONVERSION') {
    handleAdditionalToneConversion(request.text, request.tone, _sender.tab?.id)
      .then(() => sendResponse({ success: true }))
      .catch(err => sendResponse({ success: false, error: err.message }));
    return true;
  }

  // â­ ì¶”ê°€ ë²ˆì—­ ìš”ì²­ (íŒì—…ì—ì„œ ë‹¤ë¥¸ ì–¸ì–´ ì„ íƒ ì‹œ)
  if (request.action === 'REQUEST_TRANSLATION') {
    handleAdditionalTranslation(request.text, request.targetLanguage, _sender.tab?.id)
      .then(() => sendResponse({ success: true }))
      .catch(err => sendResponse({ success: false, error: err.message }));
    return true;
  }

  return false;
});

/**
 * â­ ì¶”ê°€ í†¤ ë³€í™˜ ìš”ì²­ ì²˜ë¦¬ (ë‹¤ë¥¸ í†¤ ì„ íƒ ì‹œ)
 */
async function handleAdditionalToneConversion(text: string, tone: ToneType, tabId?: number) {
  if (!tabId) return;

  const data = await getStorageData();
  const { settings, apiKeys } = data;
  const provider = settings.selectedProvider;
  const model = settings.providerModels[provider];
  const encryptedKey = apiKeys[provider];

  if (!encryptedKey) throw new Error(`${provider} API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);

  const apiKey = await decryptData(encryptedKey);

  const result = await AIOrchestrator.execute(text, 'tone-conversion', {
    provider, model, apiKey, tone
  }) as AIApiResponse;

  await chrome.tabs.sendMessage(tabId, {
    action: 'POPUP_SHOW_TONE_RESULT',
    tone: tone,
    result: result[tone]
  });

  await logUsage({
    provider, model,
    task: 'tone-conversion',
    inputTokens: Math.ceil(text.length * 0.75),
    outputTokens: Math.ceil((result[tone] || '').length * 0.75)
  });
}

/**
 * ì¶”ê°€ ë²ˆì—­ ìš”ì²­ ì²˜ë¦¬
 */
async function handleAdditionalTranslation(text: string, targetLanguage: string, tabId?: number) {
  if (!tabId) return;

  const data = await getStorageData();
  const { settings, apiKeys } = data;

  const result = await translateText(text, targetLanguage as any, settings, apiKeys);

  if (result.success) {
    await chrome.tabs.sendMessage(tabId, {
      action: 'POPUP_SHOW_TRANSLATION_RESULT',
      language: targetLanguage,
      translatedText: result.translatedText
    });
  } else {
    await chrome.tabs.sendMessage(tabId, {
      action: 'POPUP_SHOW_ERROR',
      error: result.error || 'ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
    });
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] `handleInstantToneConversion` ìˆ˜ì • ì™„ë£Œ (ì„¤ì •í•œ í†¤ë§Œ ìš°ì„  ë³€í™˜)
- [ ] `handleInstantTranslation` ìˆ˜ì • ì™„ë£Œ
- [ ] ì–¸ì–´ ìë™ ê°ì§€ ë¡œì§ êµ¬í˜„ (í•œê¸€â†’ì˜ì–´, ë¹„í•œê¸€â†’í•œê¸€)
- [ ] `isKoreanText()` í•¨ìˆ˜ ì¶”ê°€
- [ ] `REQUEST_TONE_CONVERSION` í•¸ë“¤ëŸ¬ ì¶”ê°€ (ë‹¤ë¥¸ í†¤ ìš”ì²­ ì‹œ)
- [ ] `REQUEST_TRANSLATION` í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] ì‚¬ìš©ëŸ‰ ë¡œê¹… ìœ ì§€

---

#### Step 3.4: Phase 3 í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:**
```bash
cd /Users/sijin/Downloads/07.\ Cursor/business-message
npm run build
```

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| TypeScript ì»´íŒŒì¼ | íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ | â¬œ |
| Vite ë¹Œë“œ | ë¹Œë“œ ì„±ê³µ | â¬œ |
| í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ | ì •ìƒ | â¬œ |

**í†µê³¼ ê¸°ì¤€:** ë¹Œë“œ ì˜¤ë¥˜ 0ê°œ

---

### ğŸ“Œ Phase 4: Content Script ìˆ˜ì • (ì˜ˆìƒ ì†Œìš”: 1ì‹œê°„)

---

#### Step 4.1: ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ í™•ì¥

**íŒŒì¼:** `src/content/index.ts` (ìˆ˜ì •)

```typescript
import '../styles/global.css';
import { prepareSelectionForReplacement, replaceSelectedText } from './replacer';
import { showToast } from './toast';
import { floatingPopup } from './floating-popup';

console.log('BCA Content Script Injected and Ready');

chrome.runtime.onMessage.addListener((request, _sender, sendResponse) => {
  console.log(`Content Script received action: ${request.action}`);

  switch (request.action) {
    case 'PING':
      sendResponse({ success: true, message: 'pong' });
      break;

    case 'GET_SELECTED_TEXT':
      const selection = window.getSelection();
      const text = selection?.toString() || '';
      
      let selectionRect = null;
      if (selection && selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const rect = range.getBoundingClientRect();
        selectionRect = {
          top: rect.top, left: rect.left,
          bottom: rect.bottom, right: rect.right,
          width: rect.width, height: rect.height
        };
      }
      
      sendResponse({ text, selectionRect });
      break;

    case 'REMOVE_LOADING':
      document.getElementById('bca-selection-loading')?.remove();
      sendResponse({ success: true });
      break;

    case 'REPLACE_SELECTED_TEXT':
      replaceSelectedText(request.text, request.append);
      sendResponse({ success: true });
      break;

    case 'SHOW_TOAST':
      showToast(request.message, request.type);
      sendResponse({ success: true });
      break;

    // â­ í†¤ ë³€í™˜ íŒì—… í‘œì‹œ (ê¸°ë³¸ í†¤ í¬í•¨)
    case 'SHOW_CONVERSION_POPUP':
      floatingPopup.show(request.originalText, {
        mode: 'tone',
        defaultTone: request.defaultTone || 'formal',  // â­ ê¸°ë³¸ í†¤ ì „ë‹¬
        position: calculatePopupPosition(request.selectionRect)
      });
      sendResponse({ success: true });
      break;

    // â­ ë²ˆì—­ íŒì—… í‘œì‹œ (ì–¸ì–´ ìë™ ê°ì§€)
    case 'SHOW_TRANSLATION_POPUP':
      floatingPopup.show(request.originalText, {
        mode: 'translation',
        // isKoreanInputì´ ì „ë‹¬ë˜ë©´ ì‚¬ìš©, ì•„ë‹ˆë©´ ìë™ ê°ì§€
        position: calculatePopupPosition(request.selectionRect)
      });
      sendResponse({ success: true });
      break;

    // â­ í†¤ ë³€í™˜ ê²°ê³¼ í‘œì‹œ (ê°œë³„ í†¤)
    case 'POPUP_SHOW_TONE_RESULT':
      floatingPopup.showToneResult(request.tone, request.result);  // â­ ê°œë³„ í†¤, ê²°ê³¼
      sendResponse({ success: true });
      break;

    // â­ ë²ˆì—­ ê²°ê³¼ í‘œì‹œ
    case 'POPUP_SHOW_TRANSLATION_RESULT':
      floatingPopup.showTranslationResult(request.language, request.translatedText);
      sendResponse({ success: true });
      break;

    case 'POPUP_SHOW_ERROR':
      floatingPopup.showError(request.error);
      sendResponse({ success: true });
      break;

    case 'HIDE_POPUP':
      floatingPopup.hide();
      sendResponse({ success: true });
      break;

    default:
      sendResponse({ error: 'Unknown action' });
  }

  return true;
});

function calculatePopupPosition(selectionRect: any): { x: number; y: number } {
  const POPUP_WIDTH = 450;
  const POPUP_HEIGHT = 450;
  const MARGIN = 16;

  if (!selectionRect) {
    return {
      x: (window.innerWidth - POPUP_WIDTH) / 2,
      y: (window.innerHeight - POPUP_HEIGHT) / 2
    };
  }

  let x = selectionRect.left;
  let y = selectionRect.bottom + MARGIN;

  if (x + POPUP_WIDTH > window.innerWidth - MARGIN) {
    x = window.innerWidth - POPUP_WIDTH - MARGIN;
  }
  if (x < MARGIN) x = MARGIN;

  if (y + POPUP_HEIGHT > window.innerHeight - MARGIN) {
    y = selectionRect.top - POPUP_HEIGHT - MARGIN;
  }
  if (y < MARGIN) y = MARGIN;

  return { x, y };
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] `SHOW_CONVERSION_POPUP` í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] `SHOW_TRANSLATION_POPUP` í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] `POPUP_SHOW_TONE_RESULT` í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] `POPUP_SHOW_TRANSLATION_RESULT` í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] `calculatePopupPosition` í•¨ìˆ˜

---

#### Step 4.2: Phase 4 í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:**
```bash
cd /Users/sijin/Downloads/07.\ Cursor/business-message
npm run build
```

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| TypeScript ì»´íŒŒì¼ | íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ | â¬œ |
| Vite ë¹Œë“œ | ë¹Œë“œ ì„±ê³µ | â¬œ |

**í†µê³¼ ê¸°ì¤€:** ë¹Œë“œ ì˜¤ë¥˜ 0ê°œ

---

### ğŸ“Œ Phase 5: í†µí•© í…ŒìŠ¤íŠ¸ (ì˜ˆìƒ ì†Œìš”: 2ì‹œê°„)

---

#### Step 5.1: ë¹Œë“œ ë° í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œ

**ë¹Œë“œ ëª…ë ¹ì–´:**
```bash
cd /Users/sijin/Downloads/07.\ Cursor/business-message
npm run build
```

**í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œ:**
1. Chromeì—ì„œ `chrome://extensions` ì ‘ì†
2. "ê°œë°œì ëª¨ë“œ" í™œì„±í™”
3. "ì••ì¶•í•´ì œëœ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë¡œë“œí•©ë‹ˆë‹¤" í´ë¦­
4. `dist` í´ë” ì„ íƒ

---

#### Step 5.2: í†¤ ë³€í™˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| ì¼ë°˜ ì›¹í˜ì´ì§€ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ í›„ í†¤ ë³€í™˜ ë‹¨ì¶•í‚¤ ì‹¤í–‰ | í†¤ ë³€í™˜ íŒì—… í‘œì‹œ | â¬œ |
| íŒì—… ë¡œë”© ìŠ¤í”¼ë„ˆ | "AIê°€ í†¤ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤..." í‘œì‹œ | â¬œ |
| AI ë³€í™˜ ì™„ë£Œ | ì„¤ì •í•œ ê¸°ë³¸ í†¤ ê²°ê³¼ í‘œì‹œ | â¬œ |
| ë‹¤ë¥¸ í†¤ íƒ­ í´ë¦­ (ìµœì´ˆ) | í•´ë‹¹ í†¤ ë³€í™˜ ìš”ì²­ + ë¡œë”© â†’ ê²°ê³¼ í‘œì‹œ | â¬œ |
| ì´ë¯¸ ë³€í™˜ëœ í†¤ íƒ­ í´ë¦­ | ìºì‹œëœ ê²°ê³¼ ì¦‰ì‹œ í‘œì‹œ (ì¬ìš”ì²­ ì—†ìŒ) | â¬œ |
| "ê²°ê³¼ ë³µì‚¬" í´ë¦­ | í´ë¦½ë³´ë“œì— ë³µì‚¬ + "ë³µì‚¬ë¨!" í‘œì‹œ | â¬œ |
| ESC í‚¤ | íŒì—… ë‹«í˜ | â¬œ |
| íŒì—… ì™¸ë¶€ í´ë¦­ | íŒì—… ë‹«í˜ | â¬œ |

---

#### Step 5.3: ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ (í•œê¸€ ì…ë ¥)

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| **í•œê¸€** í…ìŠ¤íŠ¸ ì„ íƒ í›„ ë²ˆì—­ ë‹¨ì¶•í‚¤ ì‹¤í–‰ | ë²ˆì—­ íŒì—… í‘œì‹œ | â¬œ |
| **ìë™ ì–¸ì–´ ê°ì§€** | ğŸ‡ºğŸ‡¸ ì˜ì–´ê°€ ìë™ ì„ íƒë¨ | â¬œ |
| íŒì—… ë¡œë”© ìŠ¤í”¼ë„ˆ | "AIê°€ ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤..." í‘œì‹œ | â¬œ |
| ì˜ì–´ ë²ˆì—­ ì™„ë£Œ | ì˜ì–´ ë²ˆì—­ ê²°ê³¼ í‘œì‹œ | â¬œ |
| ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ íƒ­ í´ë¦­ | ì¼ë³¸ì–´ ë²ˆì—­ ìš”ì²­ + ê²°ê³¼ í‘œì‹œ | â¬œ |
| ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´ íƒ­ í´ë¦­ | ì¤‘êµ­ì–´ ë²ˆì—­ ìš”ì²­ + ê²°ê³¼ í‘œì‹œ | â¬œ |
| ì–¸ì–´ ì„ íƒ íƒ­ | ğŸ‡ºğŸ‡¸ ì˜ì–´, ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´, ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´ í‘œì‹œë¨ | â¬œ |

#### Step 5.4: ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ (ë¹„í•œê¸€ ì…ë ¥)

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| **ì˜ì–´** í…ìŠ¤íŠ¸ ì„ íƒ í›„ ë²ˆì—­ ë‹¨ì¶•í‚¤ ì‹¤í–‰ | ë²ˆì—­ íŒì—… í‘œì‹œ | â¬œ |
| **ìë™ ì–¸ì–´ ê°ì§€** | ğŸ‡°ğŸ‡· í•œê¸€ì´ ìë™ ì„ íƒë¨ | â¬œ |
| í•œê¸€ ë²ˆì—­ ì™„ë£Œ | í•œê¸€ ë²ˆì—­ ê²°ê³¼ í‘œì‹œ | â¬œ |
| ì–¸ì–´ ì„ íƒ íƒ­ | ğŸ‡°ğŸ‡· í•œê¸€ (ìë™) ë§Œ í‘œì‹œ, ì˜µì…˜ ì—†ìŒ | â¬œ |
| **ì¼ë³¸ì–´** í…ìŠ¤íŠ¸ ì„ íƒ í›„ ë²ˆì—­ ë‹¨ì¶•í‚¤ ì‹¤í–‰ | ğŸ‡°ğŸ‡· í•œê¸€ë¡œ ìë™ ë²ˆì—­ | â¬œ |
| **ì¤‘êµ­ì–´** í…ìŠ¤íŠ¸ ì„ íƒ í›„ ë²ˆì—­ ë‹¨ì¶•í‚¤ ì‹¤í–‰ | ğŸ‡°ğŸ‡· í•œê¸€ë¡œ ìë™ ë²ˆì—­ | â¬œ |
| ë‹¤ì‹œ ğŸ‡ºğŸ‡¸ ì˜ì–´ íƒ­ í´ë¦­ | ìºì‹œëœ ì˜ì–´ ê²°ê³¼ í‘œì‹œ (ì¬ìš”ì²­ ì—†ìŒ) | â¬œ |

---

#### Step 5.5: ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸
| "ê²°ê³¼ ë³µì‚¬" í´ë¦­ | ì„ íƒëœ ì–¸ì–´ì˜ ë²ˆì—­ ê²°ê³¼ ë³µì‚¬ | â¬œ |

#### Step 5.6: ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| í†¤ ë³€í™˜ íŒì—…ì—ì„œ "ë²ˆì—­" íƒ­ í´ë¦­ | ë²ˆì—­ ëª¨ë“œë¡œ ì „í™˜, ì–¸ì–´ ì„ íƒ íƒ­ í‘œì‹œ | â¬œ |
| ë²ˆì—­ íŒì—…ì—ì„œ "í†¤ ë³€í™˜" íƒ­ í´ë¦­ | í†¤ ë³€í™˜ ëª¨ë“œë¡œ ì „í™˜, í†¤ ì„ íƒ íƒ­ í‘œì‹œ | â¬œ |

---

#### Step 5.7: ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | ìƒíƒœ |
|-------------|-----------|------|
| API í‚¤ ë¯¸ì„¤ì • | "API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." ì—ëŸ¬ | â¬œ |
| í…ìŠ¤íŠ¸ ë¯¸ì„ íƒ | Toast ì•Œë¦¼ í‘œì‹œ | â¬œ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ | â¬œ |

---

## 5. ë¡¤ë°± ê³„íš

ë¬¸ì œ ë°œìƒ ì‹œ:

```bash
# ìƒˆ íŒŒì¼ ì œê±°
rm src/content/floating-popup.ts
rm src/types/content.ts

# ìˆ˜ì •ëœ íŒŒì¼ ë³µì›
git checkout HEAD~1 -- src/content/index.ts
git checkout HEAD~1 -- src/background/commands.ts
git checkout HEAD~1 -- src/background/index.ts
```

---

## 6. ìš”ì•½

### í•µì‹¬ ë³€ê²½ ì‚¬í•­

1. **í†¤ ë³€í™˜**: í…ìŠ¤íŠ¸ ì„ íƒ â†’ íŒì—…ìœ¼ë¡œ ì„¤ì •í•œ í†¤ ê²°ê³¼ ìš°ì„  í‘œì‹œ (ë‹¤ë¥¸ í†¤ì€ ìš”ì²­ ì‹œ)
2. **ë²ˆì—­**: í•œê¸€ â†’ ì˜ì–´/ì¼ë³¸ì–´/ì¤‘êµ­ì–´ ë²ˆì—­ (ì˜ì–´ ê¸°ë³¸)
3. **íŒì—… UI**: ëª¨ë“œ ì „í™˜ (í†¤ ë³€í™˜ â†” ë²ˆì—­) ì§€ì›
4. **ê¸°ìˆ  ìŠ¤íƒ**: Shadow DOM ê¸°ë°˜ í”Œë¡œíŒ… íŒì—…

### ì´ ì˜ˆìƒ ì†Œìš” ì‹œê°„

| Phase | ë‚´ìš© | ì†Œìš” ì‹œê°„ |
|-------|------|----------|
| Phase 1 | íƒ€ì… ë° ê¸°ë°˜ êµ¬ì¡° | 2ì‹œê°„ |
| Phase 2 | í”Œë¡œíŒ… íŒì—… ì»´í¬ë„ŒíŠ¸ | 5ì‹œê°„ |
| Phase 3 | Background Script ìˆ˜ì • | 3ì‹œê°„ |
| Phase 4 | Content Script ìˆ˜ì • | 1ì‹œê°„ |
| Phase 5 | í†µí•© í…ŒìŠ¤íŠ¸ | 2ì‹œê°„ |
| **ì´ê³„** | | **ì•½ 13ì‹œê°„** |

---

**ë¬¸ì„œ ì‘ì„±ì¼:** 2026-01-12  
**ë¬¸ì„œ ë²„ì „:** 3.0  
**ì‘ì„±ì:** BCA Development Team
