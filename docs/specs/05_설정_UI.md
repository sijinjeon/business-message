# 기능 상세 스펙 문서 - 05. 설정 UI

> **문서 버전**: 1.0  
> **작성일**: 2025-12-25  
> **담당 모듈**: `src/options/Settings.tsx`

---

## 목차

1. [개요](#1-개요)
2. [UI 구조](#2-ui-구조)
3. [API 키 관리 섹션](#3-api-키-관리-섹션)
4. [자동 복사 설정](#4-자동-복사-설정)
5. [API 키 발급 가이드](#5-api-키-발급-가이드)
6. [상태 관리](#6-상태-관리)

---

## 1. 개요

### 1.1 설정 페이지 정의

**설정 페이지**는 사용자가 AI 제공업체를 선택하고 API 키를 관리하며, 앱의 동작 방식을 커스터마이징하는 전용 페이지입니다.

**접근 방법**:
1. 팝업에서 설정 아이콘 클릭
2. 우클릭 → "옵션" 메뉴
3. `chrome://extensions` → 확장 프로그램 상세 → "옵션"

**페이지 타입**: 전체 탭 (새 브라우저 탭에서 열림)

**크기**: 반응형 (최대 너비 800px, 중앙 정렬)

---

## 2. UI 구조

### 2.1 전체 레이아웃

```
┌─────────────────────────────────────────────────┐
│  Header                                         │  80px
│  - 제목: "설정"                                 │
│  - 설명: "정중한 문장 도우미를 사용하기 위해..." │
├─────────────────────────────────────────────────┤
│                                                 │
│  Card 1: AI 제공업체 선택                       │  150px
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  Card 2: API 키 설정                            │  280px
│  - API 키 입력                                  │
│  - 연결 테스트 버튼                             │
│  - 저장 버튼                                    │
│  - 상태 메시지                                  │
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  Card 3: 자동 복사 설정                         │  200px
│  - 활성화 체크박스                              │
│  - 톤 선택                                      │
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  Card 4: API 키 발급 방법                       │  300px
│  - 제공업체별 가이드                            │
│  - 링크 및 안내                                 │
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  Footer                                         │  80px
│  - 개인정보 보호 안내                           │
│                                                 │
└─────────────────────────────────────────────────┘

총 높이: ~1090px (스크롤 가능)
최대 너비: 800px (중앙 정렬)
여백: 32px (상하좌우)
```

---

## 3. API 키 관리 섹션

### 3.1 AI 제공업체 선택 카드

**컴포넌트 구조**:
```tsx
<Card>
  <CardHeader>
    <CardTitle>AI 제공업체 선택</CardTitle>
  </CardHeader>
  <CardContent className="space-y-4">
    <div className="space-y-2">
      <label className="text-sm font-medium">AI 제공업체</label>
      <Select value={selectedProvider} onValueChange={handleProviderChange}>
        <SelectItem value="gemini">
          Google Gemini - Google의 최신 AI 모델
        </SelectItem>
        <SelectItem value="chatgpt">
          ChatGPT - OpenAI의 GPT 모델
        </SelectItem>
        <SelectItem value="claude">
          Claude - Anthropic의 Claude 모델
        </SelectItem>
      </Select>
      <p className="text-xs text-muted-foreground">
        현재 모델: {currentProvider.model}
      </p>
    </div>
  </CardContent>
</Card>
```

**상태 변수**:
```typescript
const [selectedProvider, setSelectedProviderState] = useState<AIProvider>('gemini')
```

**핸들러**:
```typescript
const handleProviderChange = async (provider: string) => {
  const newProvider = provider as AIProvider
  setSelectedProviderState(newProvider)
  
  try {
    await setSelectedProvider(newProvider)
  } catch (error) {
    console.error('Failed to save provider setting:', error)
  }
}
```

### 3.2 API 키 설정 카드

**컴포넌트 구조**:
```tsx
<Card>
  <CardHeader>
    <CardTitle>{currentProvider.name} API 키 설정</CardTitle>
  </CardHeader>
  <CardContent className="space-y-4">
    {/* API 키 입력 */}
    <div className="space-y-2">
      <label className="text-sm font-medium">API 키</label>
      <Input
        type="password"
        value={currentApiKey}
        onChange={(e) => handleApiKeyChange(selectedProvider, e.target.value)}
        placeholder={`${currentProvider.name} API 키를 입력하세요`}
        className="font-mono"
      />
    </div>
    
    {/* 버튼 영역 */}
    <div className="flex gap-2">
      <Button variant="secondary" onClick={handleTest} disabled={validationState === 'testing'}>
        {validationState === 'testing' ? (
          <>
            <Loader2 className="w-4 h-4 mr-2 animate-spin" />
            연결 테스트 중...
          </>
        ) : '연결 테스트'}
      </Button>
      
      <Button onClick={handleSave} disabled={isSaving}>
        {isSaving ? (
          <>
            <Loader2 className="w-4 h-4 mr-2 animate-spin" />
            저장 중...
          </>
        ) : '저장'}
      </Button>
    </div>
    
    {/* 상태 메시지 */}
    {message && (
      <Alert variant={validationState === 'error' ? 'destructive' : 'default'}>
        <div className="flex items-center gap-2">
          {validationState === 'success' && 
            <CheckCircle className="w-4 h-4 text-green-600" />}
          {validationState === 'error' && 
            <XCircle className="w-4 h-4" />}
          <AlertDescription>{message}</AlertDescription>
        </div>
      </Alert>
    )}
  </CardContent>
</Card>
```

**상태 변수**:
```typescript
type ValidationState = 'idle' | 'testing' | 'success' | 'error'

const [apiKeys, setApiKeys] = useState({
  gemini: '',
  chatgpt: '',
  claude: ''
})
const [validationState, setValidationState] = useState<ValidationState>('idle')
const [message, setMessage] = useState('')
const [isSaving, setIsSaving] = useState(false)
```

**핸들러**:
```typescript
// API 키 입력 변경
const handleApiKeyChange = (provider: AIProvider, value: string) => {
  setApiKeys(prev => ({
    ...prev,
    [provider]: value
  }))
}

// 연결 테스트
const handleTest = async () => {
  const currentApiKey = apiKeys[selectedProvider]
  
  if (!currentApiKey.trim()) {
    setMessage('API 키를 입력해주세요.')
    return
  }
  
  setValidationState('testing')
  setMessage('')
  
  try {
    const isValid = await validateApiKey(selectedProvider, currentApiKey.trim())
    if (isValid) {
      setValidationState('success')
      setMessage('API 키가 유효합니다!')
    } else {
      setValidationState('error')
      setMessage('유효하지 않은 API 키입니다.')
    }
  } catch (error) {
    setValidationState('error')
    setMessage('연결 테스트 중 오류가 발생했습니다.')
  }
}

// 저장
const handleSave = async () => {
  const currentApiKey = apiKeys[selectedProvider]
  
  if (!currentApiKey.trim()) {
    setMessage('API 키를 입력해주세요.')
    return
  }
  
  setIsSaving(true)
  setMessage('')
  
  try {
    await saveApiKey(selectedProvider, currentApiKey.trim())
    await setAutoCopyEnabled(autoCopyEnabled)
    await setAutoCopyTone(autoCopyTone)
    setMessage('설정이 저장되었습니다.')
    setTimeout(() => setMessage(''), 3000)
  } catch (error) {
    setMessage('저장 중 오류가 발생했습니다.')
  } finally {
    setIsSaving(false)
  }
}
```

---

## 4. 자동 복사 설정

### 4.1 UI 구조

```tsx
<Card>
  <CardHeader>
    <CardTitle>자동 복사 설정</CardTitle>
  </CardHeader>
  <CardContent className="space-y-4">
    {/* 자동 복사 활성화 */}
    <div className="flex items-center space-x-3">
      <Checkbox
        id="auto-copy"
        checked={autoCopyEnabled}
        onCheckedChange={handleAutoCopyToggle}
      />
      <div className="space-y-1">
        <label htmlFor="auto-copy" className="text-sm font-medium cursor-pointer">
          변환 완료 시 결과를 자동으로 클립보드에 복사
        </label>
        <p className="text-xs text-muted-foreground">
          활성화하면 변환이 완료될 때 선택한 톤의 결과가 자동으로 클립보드에 복사됩니다.
        </p>
      </div>
    </div>
    
    {/* 자동 복사 톤 선택 (조건부) */}
    {autoCopyEnabled && (
      <div className="space-y-2 ml-7">
        <label className="text-sm font-medium">자동 복사할 톤 선택</label>
        <Select value={autoCopyTone} onValueChange={handleAutoCopyToneChange}>
          <SelectItem value="formal">비즈니스 이메일</SelectItem>
          <SelectItem value="general">사내 메신저</SelectItem>
          <SelectItem value="friendly">캐주얼 채팅</SelectItem>
        </Select>
        <p className="text-xs text-muted-foreground">
          변환 완료 시 선택한 톤의 결과가 자동으로 클립보드에 복사됩니다.
        </p>
      </div>
    )}
  </CardContent>
</Card>
```

**상태 변수**:
```typescript
const [autoCopyEnabled, setAutoCopyEnabledState] = useState(true)
const [autoCopyTone, setAutoCopyToneState] = useState<'formal' | 'general' | 'friendly'>('formal')
```

**핸들러**:
```typescript
const handleAutoCopyToggle = async (enabled: boolean) => {
  setAutoCopyEnabledState(enabled)
  try {
    await setAutoCopyEnabled(enabled)
  } catch (error) {
    console.error('Failed to save auto copy setting:', error)
  }
}

const handleAutoCopyToneChange = async (value: string) => {
  const tone = value as 'formal' | 'general' | 'friendly'
  setAutoCopyToneState(tone)
  try {
    await setAutoCopyTone(tone)
  } catch (error) {
    console.error('Failed to save auto copy tone:', error)
  }
}
```

---

## 5. API 키 발급 가이드

### 5.1 제공업체별 가이드

**조건부 렌더링**:
```tsx
<Card>
  <CardHeader>
    <CardTitle>API 키 발급 방법</CardTitle>
  </CardHeader>
  <CardContent className="space-y-6">
    {selectedProvider === 'gemini' && <GeminiGuide />}
    {selectedProvider === 'chatgpt' && <ChatGPTGuide />}
    {selectedProvider === 'claude' && <ClaudeGuide />}
    
    <PrivacyNotice />
  </CardContent>
</Card>
```

#### Google Gemini 가이드

```tsx
<div className="space-y-3">
  <h4 className="font-medium">Google Gemini API 키 발급</h4>
  <ol className="list-decimal list-inside space-y-2 text-sm">
    <li>
      <a href="https://ai.google.dev/" target="_blank" rel="noopener noreferrer"
         className="text-primary hover:underline">
        Google AI Studio
      </a>에 접속합니다.
    </li>
    <li>Google 계정으로 로그인합니다.</li>
    <li>"Get API Key" 버튼을 클릭합니다.</li>
    <li>"Create API Key"를 선택하여 새 API 키를 생성합니다.</li>
    <li>생성된 API 키를 복사하여 위 입력란에 붙여넣습니다.</li>
  </ol>
</div>
```

#### OpenAI 가이드

```tsx
<div className="space-y-3">
  <h4 className="font-medium">OpenAI API 키 발급</h4>
  <ol className="list-decimal list-inside space-y-2 text-sm">
    <li>
      <a href="https://platform.openai.com/api-keys" target="_blank"
         className="text-primary hover:underline">
        OpenAI Platform
      </a>에 접속합니다.
    </li>
    <li>OpenAI 계정으로 로그인합니다.</li>
    <li>"Create new secret key" 버튼을 클릭합니다.</li>
    <li>키 이름을 입력하고 "Create secret key"를 클릭합니다.</li>
    <li>생성된 API 키를 복사하여 위 입력란에 붙여넣습니다.</li>
  </ol>
  <div className="p-3 bg-yellow-50 rounded-lg">
    <p className="text-xs text-yellow-800">
      <strong>주의:</strong> OpenAI API는 유료 서비스입니다. 
      사용량에 따라 요금이 부과됩니다.
    </p>
  </div>
</div>
```

#### Claude 가이드

```tsx
<div className="space-y-3">
  <h4 className="font-medium">Anthropic Claude API 키 발급</h4>
  <ol className="list-decimal list-inside space-y-2 text-sm">
    <li>
      <a href="https://console.anthropic.com/" target="_blank"
         className="text-primary hover:underline">
        Anthropic Console
      </a>에 접속합니다.
    </li>
    <li>Anthropic 계정으로 로그인합니다.</li>
    <li>좌측 메뉴에서 "API Keys"를 클릭합니다.</li>
    <li>"Create Key" 버튼을 클릭합니다.</li>
    <li>생성된 API 키를 복사하여 위 입력란에 붙여넣습니다.</li>
  </ol>
  <div className="p-3 bg-yellow-50 rounded-lg">
    <p className="text-xs text-yellow-800">
      <strong>주의:</strong> Claude API는 유료 서비스입니다. 
      사용량에 따라 요금이 부과됩니다.
    </p>
  </div>
</div>
```

#### 개인정보 보호 안내

```tsx
<div className="mt-4 p-3 bg-muted rounded-lg">
  <p className="text-xs text-muted-foreground">
    <strong>개인정보 보호:</strong> 입력된 API 키는 암호화되어 브라우저에만 저장되며, 
    외부 서버로 전송되지 않습니다. 변환할 텍스트 역시 선택한 AI 서비스로만 전송되며 
    별도로 저장되지 않습니다.
  </p>
</div>
```

---

## 6. 상태 관리

### 6.1 상태 변수

```typescript
function Settings() {
  // AI 제공업체
  const [selectedProvider, setSelectedProviderState] = useState<AIProvider>('gemini')
  
  // API 키 (3개 제공업체)
  const [apiKeys, setApiKeys] = useState({
    gemini: '',
    chatgpt: '',
    claude: ''
  })
  
  // 검증 상태
  const [validationState, setValidationState] = useState<ValidationState>('idle')
  const [message, setMessage] = useState('')
  const [isSaving, setIsSaving] = useState(false)
  
  // 자동 복사 설정
  const [autoCopyEnabled, setAutoCopyEnabledState] = useState(true)
  const [autoCopyTone, setAutoCopyToneState] = useState<'formal' | 'general' | 'friendly'>('formal')
}
```

### 6.2 초기화

```typescript
useEffect(() => {
  loadSettings()
}, [])

const loadSettings = async () => {
  try {
    // 제공업체 로드
    const provider = await getSelectedProvider()
    
    // API 키 로드 (3개)
    const geminiKey = await getApiKey('gemini')
    const chatgptKey = await getApiKey('chatgpt')
    const claudeKey = await getApiKey('claude')
    
    // 자동 복사 설정 로드
    const autoCopy = await getAutoCopyEnabled()
    const copyTone = await getAutoCopyTone()
    
    // 상태 업데이트
    setSelectedProviderState(provider)
    setApiKeys({
      gemini: geminiKey,
      chatgpt: chatgptKey,
      claude: claudeKey
    })
    setAutoCopyEnabledState(autoCopy)
    setAutoCopyToneState(copyTone)
  } catch (error) {
    console.error('Failed to load settings:', error)
  }
}
```

### 6.3 상태 전이

```
페이지 로드
   ↓
loadSettings() (Storage 조회)
   ↓
상태 초기화 완료
   ↓
사용자 입력 대기
   ↓
   ├─→ [연결 테스트 클릭]
   │     ↓
   │   validationState = 'testing'
   │     ↓
   │   API 호출
   │     ↓
   │   validationState = 'success' | 'error'
   │     ↓
   │   메시지 표시
   │
   ├─→ [저장 클릭]
   │     ↓
   │   isSaving = true
   │     ↓
   │   암호화 + Storage 저장
   │     ↓
   │   isSaving = false
   │     ↓
   │   성공 메시지 (3초 후 제거)
   │
   └─→ [제공업체 변경]
         ↓
       selectedProvider 변경
         ↓
       API 키 입력창 업데이트
         ↓
       가이드 변경
```

---

## 7. 사용자 피드백

### 7.1 메시지 타입

| 상태 | 메시지 | 스타일 | 아이콘 | 지속 시간 |
|------|--------|--------|--------|----------|
| **검증 성공** | "API 키가 유효합니다!" | default | ✓ CheckCircle | 영구 |
| **검증 실패** | "유효하지 않은 API 키입니다." | destructive | ✗ XCircle | 영구 |
| **저장 성공** | "설정이 저장되었습니다." | default | (없음) | 3초 |
| **저장 실패** | "저장 중 오류가 발생했습니다." | destructive | (없음) | 영구 |
| **입력 누락** | "API 키를 입력해주세요." | destructive | (없음) | 영구 |

### 7.2 버튼 상태

**연결 테스트 버튼**:
```
[idle] "연결 테스트" - 활성화
  ↓
[testing] "연결 테스트 중..." + 스피너 - 비활성화
  ↓
[success/error] "연결 테스트" - 활성화
```

**저장 버튼**:
```
[idle] "저장" - 활성화
  ↓
[saving] "저장 중..." + 스피너 - 비활성화
  ↓
[완료] "저장" - 활성화
```

---

## 8. 테스트 시나리오

### 8.1 API 키 설정 플로우

```typescript
describe('Settings - API Key Management', () => {
  test('제공업체 변경 시 입력창 업데이트', async () => {
    const { getByRole, getByPlaceholderText } = render(<Settings />)
    
    // Gemini 선택
    const select = getByRole('combobox')
    fireEvent.change(select, { target: { value: 'gemini' } })
    
    expect(getByPlaceholderText(/Google Gemini/)).toBeInTheDocument()
  })
  
  test('API 키 저장 성공', async () => {
    const { getByRole, getByText } = render(<Settings />)
    
    const input = getByRole('textbox')
    fireEvent.change(input, { target: { value: 'test-api-key' } })
    
    const saveButton = getByText('저장')
    fireEvent.click(saveButton)
    
    await waitFor(() => {
      expect(getByText('설정이 저장되었습니다.')).toBeInTheDocument()
    })
  })
})
```

---

**문서 작성**: AI 코드 분석 시스템  
**최종 업데이트**: 2025-12-25

