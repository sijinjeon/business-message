# 기능 상세 스펙 문서 - 06. 데이터베이스 및 스토리지

> **문서 버전**: 2.2  
> **작성일**: 2025-12-25  
> **업데이트**: 2025-12-25 - 번역 설정 및 제공자별 모델 선택 스키마 확장
> **담당 모듈**: `src/utils/storage.ts`, Chrome Storage API

---

## 1. 개요

### 1.1 스토리지 시스템
**사용 기술**: Chrome Storage API (Local Storage)
**특징**: 
- AES-GCM으로 암호화된 API 키 저장
- 탭 정보 및 사용자 설정의 영구 보관
- v2.2 번역 관련 설정 및 제공자별 모델 선택 정보 추가

---

## 2. 데이터 스키마 (v2.2)

### 2.1 전체 구조

```typescript
export interface AppStorage {
  apiKeys: {
    gemini: string;    // 암호화됨
    chatgpt: string;   // 암호화됨
    claude: string;    // 암호화됨
  };
  settings: {
    selectedProvider: AIProvider;
    // 제공자별 선택된 세부 모델 (v2.2 추가) ⭐
    providerModels: {
      gemini: string;  // 예: 'gemini-2.5-flash'
      openai: string;  // 예: 'gpt-5'
      claude: string;  // 예: 'claude-4-5-haiku'
    };
    // 톤 변환 설정
    autoCopyEnabled: boolean;
    autoCopyTone: ToneType;
    // 번역 설정
    translation: {
      defaultTargetLanguage: 'ko' | 'en' | 'ja' | 'zh-CN';
      preserveLineBreaks: boolean;
      showNotification: boolean; 
    };
  };
  lastUsedTab: 'tone' | 'translation';
}
```

---

## 3. 기본값 (DEFAULT_STORAGE)

```typescript
const DEFAULT_STORAGE: AppStorage = {
  apiKeys: { gemini: '', chatgpt: '', claude: '' },
  settings: {
    selectedProvider: 'gemini',
    providerModels: {
      gemini: 'gemini-2.5-flash',
      openai: 'gpt-5',
      claude: 'claude-4-5-haiku'
    },
    autoCopyEnabled: true,
    autoCopyTone: 'formal',
    translation: {
      defaultTargetLanguage: 'ko',
      preserveLineBreaks: true,
      showNotification: true
    }
  },
  lastUsedTab: 'tone'
}
```

---

## 4. 데이터 접근 및 유틸리티

### 4.1 제공자 및 모델 관리
- `getSelectedProvider()` / `setSelectedProvider(provider)`
- `getProviderModel(provider)` / `setProviderModel(provider, model)` ⭐

### 4.2 번역 설정 전용 함수
- `getTranslationSettings()`: 전체 번역 설정 조회
- `updateTranslationSettings(Partial<TranslationSettings>)`: 설정 일부 업데이트
- `getLastUsedTab()` / `setLastUsedTab(tab)`: 팝업 상태 관리

---

**문서 작성**: BCA 개발팀  
**최종 업데이트**: 2025-12-25
