# 기능 상세 스펙 문서 - 03. 텍스트 조작 및 클립보드 연동

> **문서 버전**: 2.2  
> **작성일**: 2025-12-25  
> **업데이트**: 2025-12-25 - 선택 영역 감지 및 텍스트 대체 기능 추가
> **담당 모듈**: `src/content/replacer.ts`, `src/utils/clipboard.ts`

---

## 1. 개요

### 1.1 목적
사용자가 선택한 텍스트를 추출하고, 번역 결과를 다시 해당 위치에 삽입하거나 클립보드와 상호작용하는 모든 기능을 다룹니다.

---

## 2. 텍스트 추출 및 대체 (v2.2)

### 2.1 선택 영역 감지 (Content Script)
- `window.getSelection()` API를 사용하여 사용자가 현재 드래그한 텍스트를 추출합니다.
- 추출된 텍스트의 범위(`Range`) 정보를 임시 저장하여 번역 완료 후 복원 지점으로 사용합니다.

### 2.2 텍스트 대체 로직
- **일반 텍스트**: `document.execCommand('insertText')`를 사용하여 선택된 텍스트를 번역문으로 즉시 교체합니다. (Undo/Redo 지원을 위함)
- **입력 폼(Textarea/Input)**: 해당 요소의 `value`를 직접 조작하여 대체합니다.
- **ContentEditable**: DOM 노드를 직접 조작하여 줄바꿈 형식을 유지한 채 삽입합니다.

---

## 3. 클립보드 상호작용

### 3.1 팝업 자동 읽기
- 팝업이 열릴 때 `navigator.clipboard.readText()`를 호출하여 클립보드 내용을 입력창에 자동 반영합니다.

### 3.2 자동 복사 정책
- 사용자의 설정에 따라 톤 변환 결과 또는 번역 결과를 자동으로 클립보드에 기록합니다.

---

## 4. 예외 케이스 처리

- **보안 사이트**: 스크립트 실행이 금지된 사이트에서는 클립보드 복사 기능을 우선 안내합니다.
- **읽기 전용 영역**: 수정을 시도하기 전 해당 요소의 수정 가능 여부를 먼저 체크합니다.

---

**문서 작성**: BCA 개발팀  
**최종 업데이트**: 2025-12-25
