# 기능 상세 스펙 문서 - 02. AI 통합

> **문서 버전**: 2.5 (2026.01.05 Update)
> **작성일**: 2026-01-01
> **업데이트**: 2026-01-05 - Gemini 3.0-flash-preview 및 최신 모델 라인업 반영
> **담당 모듈**: `src/services/ai/`

---

## 1. 개요 (v2.5)

### 1.1 AI Orchestrator 패턴
기존의 파편화된 API 호출 방식을 지양하고, `AIOrchestrator`를 통한 통합 제어 시스템으로 전환되었습니다. 이를 통해 새로운 AI 제공자 추가가 용이해졌으며, 공통된 JSON 파싱 및 에러 처리 로직을 공유합니다.

---

## 2. 시스템 구조

### 2.1 AIOrchestrator
- **역할**: 클라이언트 요청을 적절한 Provider에게 전달하고 응답을 정규화합니다.
- **핵심 메서드**: `execute(text, task, options)`
- **JSON 파싱**: AI 응답에서 Markdown 블록을 추출하거나 중괄호(`{}`) 위치를 추적하여 안정적으로 JSON을 추출합니다.

### 2.2 Provider 구조
- **BaseAIProvider**: 모든 AI 제공자가 상속받는 추상 클래스입니다.
- **GeminiProvider**: Google Gemini API 연동 (JSON 모드 지원).
- **OpenAIProvider**: OpenAI GPT-5 계열 연동.
- **ClaudeProvider**: Anthropic Claude 4.5 계열 연동.

---

## 3. 작업별 스펙 (v2.3)

### 3.1 톤 변환 (Tone Conversion)
- **프롬프트**: 시스템 프롬프트에서 `formal`, `general`, `friendly` 3가지 키를 가진 JSON 응답을 강제합니다.
- **응답 검증**: 파싱 후 필수 필드가 누락된 경우 에러를 발생시켜 UI 안정성을 확보합니다.

### 3.2 번역 (Translation)
- **페르소나**: 전문 번역가 모드.
- **줄바꿈 보존**: 원문의 줄바꿈(`\n`)을 유지하도록 지시합니다.
- **언어 감지**: `quickDetectLanguage` 유틸리티를 통해 사용자에게 감지된 언어 정보를 제공합니다.

---

## 4. 지원 모델 및 비용 정보 (2026)

| 제공자 | 기본 모델 | 1M 토큰당 비용 (USD) | 특징 |
|--------|-----------|-----------------------|------|
| **Gemini** | `gemini-3-flash-preview` | $15.00 | 차세대 추론 엔진, 높은 정확도 |
| **Gemini** | `gemini-2.5-flash` | $0.10 | 고속, 저비용, 긴 컨텍스트 |
| **OpenAI** | `gpt-5.2` | $20.00 | 최고 성능, 정밀한 응답 |
| **Claude** | `claude-sonnet-4-5-20250929` | $18.00 | 자연스러운 문체, 전문 번역 |
| **Claude** | `claude-haiku-4-5-20251001` | $1.00 | 고속 고성능 하이쿠 모델 |

---

## 5. 예외 처리

- **JSON 파싱 실패**: Markdown 코드 블록 추출 실패 시 전체 텍스트에서 JSON 구조를 찾는 폴백 로직 작동.
- **모델 미지원**: `StorageService`의 마이그레이션 로직을 통해 구형 모델 ID를 최신 ID로 자동 변환.
- **API 키 부재**: 호출 전 단계에서 키 존재 여부를 확인하여 명확한 사용자 알림 제공.

---

**문서 업데이트**: 2026-01-01
