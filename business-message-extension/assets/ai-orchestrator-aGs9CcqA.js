var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);async function n(){const e=chrome.runtime.id,t=new TextEncoder,n="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,r=await n.subtle.importKey("raw",t.encode(e+"business-message-helper"),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return n.subtle.deriveKey({name:"PBKDF2",salt:t.encode("business-message-salt"),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function r(e){try{const t=await n(),r=(new TextEncoder).encode(e),a="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,o=a.getRandomValues(new Uint8Array(12)),i=await a.subtle.encrypt({name:"AES-GCM",iv:o},t,r),s=new Uint8Array(o.length+i.byteLength);s.set(o),s.set(new Uint8Array(i),o.length);const c=String.fromCharCode(...s);return"undefined"!=typeof btoa?btoa(c):"undefined"!=typeof self?self.btoa(c):globalThis.btoa(c)}catch(t){throw new Error("데이터 암호화에 실패했습니다.")}}async function a(e){try{const t=await n(),r="undefined"!=typeof atob?atob(e):"undefined"!=typeof self?self.atob(e):globalThis.atob(e),a=Uint8Array.from(r,e=>e.charCodeAt(0)),o=a.slice(0,12),i=a.slice(12),s="undefined"!=typeof crypto?crypto:"undefined"!=typeof self?self.crypto:globalThis.crypto,c=await s.subtle.decrypt({name:"AES-GCM",iv:o},t,i);return(new TextDecoder).decode(c)}catch(t){throw new Error("데이터 복호화에 실패했습니다.")}}const o={gemini:[{id:"gemini-3-flash-preview",name:"Gemini 3 Flash Preview",pricePer1M:15},{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash",pricePer1M:.1},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash",pricePer1M:.075}],chatgpt:[{id:"gpt-5.2",name:"GPT-5.2 (Ultra Quality)",pricePer1M:20},{id:"gpt-4o",name:"GPT-4o (High Quality)",pricePer1M:5},{id:"gpt-4o-mini",name:"GPT-4o Mini",pricePer1M:.15}],claude:[{id:"claude-sonnet-4-5-20250929",name:"Claude 4.5 Sonnet (Latest)",pricePer1M:18},{id:"claude-haiku-4-5-20251001",name:"Claude 4.5 Haiku",pricePer1M:1},{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet (v2)",pricePer1M:3},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",pricePer1M:.25}]};class i{buildPrompt(e,t,n){if("translation"===t)return`\n# Role\nProfessional translator.\n\n# Task\nTranslate the following text to ${n.targetLanguage||"Korean"}.\n\n# Critical Rules\n1. PRESERVE ALL LINE BREAKS (\\n) EXACTLY.\n2. Natural and professional tone.\n3. Output ONLY the translation result.\n\n# Original Text\n${e}\n\n# Translation\n`;if(n.tone){const t={formal:"매우 격식 있고 예의 바른 비즈니스 어조 (공식적인 메일이나 공지에 적합)",general:"정중하면서도 부드러운 일상적인 비즈니스 어조 (팀 내 협업이나 일반적인 대화에 적합)",friendly:"간결하고 친근한 어조 (가까운 동료나 편안한 사이에 적합)"};return`\n# Role\n한국 직장 문화와 커뮤니케이션에 능숙한 AI 어시스턴트.\n\n# Instruction\n주어진 'Original Text'를 아래 톤으로 변환하여 반드시 지정된 JSON 형식으로만 응답하세요.\n\n# Tone\n${n.tone}: ${t[n.tone]}\n\n# Critical Rules\n- 반드시 아래 JSON 구조를 유지하세요.\n- 설명이나 인사말 등 JSON 이외의 텍스트는 절대 포함하지 마세요.\n- 원문의 의미를 훼손하지 않으면서 톤만 자연스럽게 변경하세요.\n\n# Output Format (JSON ONLY)\n{\n  "${n.tone}": "..."\n}\n\n# Original Text\n${e}\n`}return`\n# Role\n한국 직장 문화와 커뮤니케이션에 능숙한 AI 어시스턴트.\n\n# Instruction\n주어진 'Original Text'를 아래 세 가지 톤으로 변환하여 반드시 지정된 JSON 형식으로만 응답하세요.\n\n# Tones\n1. formal: 매우 격식 있고 예의 바른 비즈니스 어조 (공식적인 메일이나 공지에 적합)\n2. general: 정중하면서도 부드러운 일상적인 비즈니스 어조 (팀 내 협업이나 일반적인 대화에 적합)\n3. friendly: 간결하고 친근한 어조 (가까운 동료나 편안한 사이에 적합)\n\n# Critical Rules\n- 반드시 아래 JSON 구조를 유지하세요.\n- 설명이나 인사말 등 JSON 이외의 텍스트는 절대 포함하지 마세요.\n- 원문의 의미를 훼손하지 않으면서 톤만 자연스럽게 변경하세요.\n\n# Output Format (JSON ONLY)\n{\n  "formal": "...",\n  "general": "...",\n  "friendly": "..."\n}\n\n# Original Text\n${e}\n`}}class s{static async execute(e,t,n){const r=this.providers[n.provider];if(!r)throw new Error(`지원하지 않는 제공자입니다: ${n.provider}`);const a=await r.call(e,t,n);return"tone-conversion"===t?this.parseJson(a):a.trim()}static parseJson(e){if(!e||""===e.trim())throw new Error("AI로부터 빈 응답을 받았습니다.");const t=e.match(/```(?:json)?\s*([\s\S]*?)\s*```/i);let n="";if(t)n=t[1].trim();else{const t=e.indexOf("{"),r=e.lastIndexOf("}");n=-1!==t&&-1!==r&&r>t?e.substring(t,r+1).trim():e.trim()}try{const e=n.replace(/[\u0000-\u001F\u007F-\u009F]/g,""),t=JSON.parse(e);if(!t.formal&&!t.general&&!t.friendly)throw new Error("유효한 톤 변환 결과를 찾을 수 없습니다.");return t}catch(r){throw new Error("유효한 JSON 응답을 찾을 수 없습니다. (응답 내용: "+e.substring(0,50)+"...)")}}}t(s,"providers",{gemini:new class extends i{constructor(){super(...arguments),t(this,"name","gemini")}async call(e,t,n){const r="tone-conversion"===t,a=this.buildPrompt(e,t,n),o=`https://generativelanguage.googleapis.com/v1beta/models/${n.model}:generateContent?key=${n.apiKey}`,i={contents:[{parts:[{text:a}]}],generationConfig:{temperature:.7,maxOutputTokens:2048,candidateCount:1,topK:40,topP:.95,responseMimeType:r?"application/json":"text/plain"}},s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(`Gemini API Error: ${s.status} - ${e.error?.message||s.statusText}`)}const c=await s.json();if(!c.candidates||0===c.candidates.length)throw new Error("Gemini API Error: No candidates returned. This might be due to safety filters.");const l=c.candidates[0].content;if(!l||!l.parts||0===l.parts.length)throw new Error("Gemini API Error: Empty content in response.");return l.parts[0].text}},chatgpt:new class extends i{constructor(){super(...arguments),t(this,"name","chatgpt")}async call(e,t,n){const r="tone-conversion"===t,a=this.buildPrompt(e,t,n),o={model:n.model,messages:[{role:"user",content:a}],temperature:.7,max_tokens:2048,response_format:r?{type:"json_object"}:void 0},i=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify(o)});if(!i.ok)throw new Error(`OpenAI API Error: ${i.status}`);return(await i.json()).choices[0].message.content}},claude:new class extends i{constructor(){super(...arguments),t(this,"name","claude")}async call(e,t,n){const r=this.buildPrompt(e,t,n);if(n.apiKey&&!n.apiKey.trim().startsWith("sk-ant-"))throw new Error("Claude API 키 형식이 올바르지 않습니다. (sk-ant-... 형식이어야 합니다)");const a={model:n.model,max_tokens:2048,temperature:.7,messages:[{role:"user",content:r}]},o=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.apiKey.trim(),"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify(a)});if(!o.ok){const e=await o.json().catch(()=>({}));if(401===o.status)throw new Error("Claude API 인증 실패: 입력하신 API 키가 유효하지 않거나 만료되었습니다. Anthropic 콘솔에서 키를 다시 확인해주세요.");throw new Error(`Claude API Error: ${o.status} - ${e.error?.message||o.statusText}`)}return(await o.json()).content[0].text}}});export{s as A,o as a,a as d,r as e};
